using System;
using System.Collections.Generic;
using DFeBR.EmissorNFe;
using DFeBR.EmissorNFe.Danfe;
using DFeBR.EmissorNFe.Danfe.Entidades;
using DFeBR.EmissorNFe.Danfe.Interfaces;
using DFeBR.EmissorNFe.Dominio.NotaFiscalEletronica;
using DFeBR.EmissorNFe.Dominio.NotaFiscalEletronica.Configurar;
using DFeBR.EmissorNFe.Dominio.NotaFiscalEletronica.Informacoes.Detalhe.Tributacao;
using DFeBR.EmissorNFe.Dominio.NotaFiscalEletronica.Informacoes.Detalhe.Tributacao.Estadual;
using DFeBR.EmissorNFe.Dominio.NotaFiscalEletronica.Informacoes.Detalhe.Tributacao.Estadual.Tipos;
using DFeBR.EmissorNFe.Dominio.NotaFiscalEletronica.Informacoes.Emitente;
using DFeBR.EmissorNFe.Dominio.NotaFiscalEletronica.RetornoServicos.Autorizacao;
using DFeBR.EmissorNFe.Dominio.NotaFiscalEletronica.RetornoServicos.Evento;
using DFeBR.EmissorNFe.Dominio.NotaFiscalEletronica.RetornoServicos.Status; 
using DFeBR.EmissorNFe.Servicos.VersaoNFe4;
using DFeBR.EmissorNFe.Utilidade;
using DFeBR.EmissorNFe.Utilidade.Tipos;
using Microsoft.VisualStudio.TestTools.UnitTesting;

namespace UnitTest3
{
    [TestClass]
    public class UnitTest1
    {

        //TODO:Refazer TODOS os teste unitarios em funcao da obrigatoriedade de informacao do intermediador da transacao
        // public infIntermed infIntermed { get; set; }

        /// <summary>
        ///     Obter dados de configuração
        /// </summary>
        /// <returns></returns>
        private EmissorServicoConfig ObterConfiguracao()
        {
            var serial = "1916ea4a695178883a8f92b10d0fa013";
           
            var c1 = new EmissorServicoConfig(VersaoServico.Ve400, Estado.Ba, TipoAmbiente.Homologacao,caminhoConfig: "Arquivos");
            c1.ConfiguraCSC("000001", "58C851CA-C1C7-413C-BBDB-3EC38CF5F39F");
            c1.ConfiguraEmitente("13712048000174", "", "JORDAN SORIDE COMERCIO LTDA", "SUPER BIKE",
                    "018738210", "", "38545300154", "4763603", CRT.SimplesNacional, "logradouro", "1", "", "Bairro", 2927408, "Municipio", "BA", "41320100",
                    null);
            c1.ConfiguraSchemaXSD(true, $@"{Environment.CurrentDirectory}\Schemas\versao4.00");
            c1.ConfiguraArquivoRetorno(true, @"D:\");
            c1.ConfiguraCertificadoA1Repositorio(serial);
            //Segurança para nao transmitir em produção
            if (c1.Ambiente == TipoAmbiente.Producao) throw new Exception("Testes em produção não permitido.");
            return c1;
        }
        
        [TestMethod]
        [Description("Consultar status do serviço")]
        public void ConsultarStatusServico()
        {
            var c1 = ObterConfiguracao();
            var config = new Configurar(c1);
            var servNfe = new ServNFe4(config.EmissorConfig);
            var result = servNfe.ConsultarStatus("65");
            //Código de status com sucesso 
            Assert.AreEqual(107, result.Retorno.cStat);
        }

        [TestMethod]
        [Description("Consultar uma NFCe pela chave")]
        public void ConsultarUmaNfCeUsandoChave()
        {
            var c1 = ObterConfiguracao();
            var config = new Configurar(c1);
            var servNfe = new ServNFe4(config.EmissorConfig);
            var chave = "NFe29190417784038000103650980000000011000000014";
            var retorno = servNfe.ConsultarPelaChave(chave, true, "65");
            Assert.IsNotNull(retorno);
        }

        [TestMethod]
        [Description("Consultar uma NFCe pela chave")]
        public void ConsultarUmaNfCeUsandoStringXml()
        {
            var c1 = ObterConfiguracao();
            var config = new Configurar(c1);
            var servNfe = new ServNFe4(config.EmissorConfig);
            //var xml = "<?xml version=\"1.0\" encoding=\"UTF-8\"?><nfeProc xmlns=\"http://www.portalfiscal.inf.br/nfe\" versao=\"3.10\"><NFe xmlns=\"http://www.portalfiscal.inf.br/nfe\"><infNFe versao=\"3.10\" Id=\"NFe29190417784038000103650980000000011000000014\"><ide><cUF>35</cUF><cNF>33397018</cNF><natOp>VENDA DE PRODUCAO</natOp><indPag>2</indPag><mod>55</mod><serie>1</serie><nNF>671</nNF><dhEmi>2016-08-24T14:59:57-02:00</dhEmi><dhSaiEnt>2016-08-25T15:00:00-02:00</dhSaiEnt><tpNF>1</tpNF><idDest>2</idDest><cMunFG>3552809</cMunFG><tpImp>1</tpImp><tpEmis>1</tpEmis><cDV>2</cDV><tpAmb>1</tpAmb><finNFe>1</finNFe><indFinal>1</indFinal><indPres>0</indPres><procEmi>0</procEmi><verProc>BIKES SPORTS BICICLE</verProc></ide><emit><CNPJ>24104582000114</CNPJ><xNome>BIKES SPORTS BICICLETAS e ACESSORIOS EIRELI</xNome><xFant>BIKES SPORTS BICICLETAS e ACESSORIOS EIRELI</xFant><enderEmit><xLgr>RUA SEBASTIAO DE SOUZA SILVA</xLgr><nro>175</nro><xBairro>PARQUE LAGUNA</xBairro><cMun>3552809</cMun><xMun>TABOAO DA SERRA</xMun><UF>SP</UF><CEP>06775970</CEP><fone>1199999999</fone></enderEmit><IE>675268326118</IE><CRT>3</CRT></emit><dest><CNPJ>17784038000103</CNPJ><xNome>ANAILTO SILVA DE OLIVEIRA</xNome><enderDest><xLgr>RUA EURICO DA COSTA COUTINHO</xLgr><nro>100</nro><xBairro>MUSSURUNGA I</xBairro><cMun>2927408</cMun><xMun>SALVADOR</xMun><UF>BA</UF><CEP>41490050</CEP><cPais>1058</cPais><xPais>BRASIL</xPais><fone>7132524235</fone></enderDest><indIEDest>1</indIEDest><IE>107728249</IE><email>duchabikes@hotmail.com</email></dest><det nItem=\"1\"><prod><cProd>000000000009679</cProd><cEAN /><xProd>BIC 16 POCOLOCA BRANCA CACESS LILAS</xProd><NCM>87120010</NCM><CFOP>6101</CFOP><uCom>PC</uCom><qCom>1.0000</qCom><vUnCom>126.1400</vUnCom><vProd>126.14</vProd><cEANTrib /><uTrib>PC</uTrib><qTrib>1.0000</qTrib><vUnTrib>126.1400</vUnTrib><indTot>1</indTot></prod><imposto><ICMS><ICMS00><orig>0</orig><CST>00</CST><modBC>0</modBC><vBC>126.14</vBC><pICMS>7.00</pICMS><vICMS>8.83</vICMS></ICMS00></ICMS><IPI><cEnq>999</cEnq><IPITrib><CST>50</CST><vBC>126.14</vBC><pIPI>10.00</pIPI><vIPI>12.61</vIPI></IPITrib></IPI><PIS><PISAliq><CST>01</CST><vBC>126.14</vBC><pPIS>0.65</pPIS><vPIS>0.82</vPIS></PISAliq></PIS><COFINS><COFINSAliq><CST>01</CST><vBC>126.14</vBC><pCOFINS>3.00</pCOFINS><vCOFINS>3.78</vCOFINS></COFINSAliq></COFINS></imposto></det><det nItem=\"2\"><prod><cProd>000000000009681</cProd><cEAN /><xProd>BIC 16 POCOLOCA PRETA CACESS PINK</xProd><NCM>87120010</NCM><CFOP>6101</CFOP><uCom>PC</uCom><qCom>2.0000</qCom><vUnCom>126.1400</vUnCom><vProd>252.28</vProd><cEANTrib /><uTrib>PC</uTrib><qTrib>2.0000</qTrib><vUnTrib>126.1400</vUnTrib><indTot>1</indTot></prod><imposto><ICMS><ICMS00><orig>0</orig><CST>00</CST><modBC>0</modBC><vBC>252.28</vBC><pICMS>7.00</pICMS><vICMS>17.66</vICMS></ICMS00></ICMS><IPI><cEnq>999</cEnq><IPITrib><CST>50</CST><vBC>252.28</vBC><pIPI>10.00</pIPI><vIPI>25.23</vIPI></IPITrib></IPI><PIS><PISAliq><CST>01</CST><vBC>252.28</vBC><pPIS>0.65</pPIS><vPIS>1.64</vPIS></PISAliq></PIS><COFINS><COFINSAliq><CST>01</CST><vBC>252.28</vBC><pCOFINS>3.00</pCOFINS><vCOFINS>7.57</vCOFINS></COFINSAliq></COFINS></imposto></det><det nItem=\"3\"><prod><cProd>000000000009680</cProd><cEAN /><xProd>BIC 16 POCOLOCA ROSA C ACESS PINK</xProd><NCM>87120010</NCM><CFOP>6101</CFOP><uCom>PC</uCom><qCom>3.0000</qCom><vUnCom>126.1400</vUnCom><vProd>378.42</vProd><cEANTrib /><uTrib>PC</uTrib><qTrib>3.0000</qTrib><vUnTrib>126.1400</vUnTrib><indTot>1</indTot></prod><imposto><ICMS><ICMS00><orig>0</orig><CST>00</CST><modBC>0</modBC><vBC>378.42</vBC><pICMS>7.00</pICMS><vICMS>26.49</vICMS></ICMS00></ICMS><IPI><cEnq>999</cEnq><IPITrib><CST>50</CST><vBC>378.42</vBC><pIPI>10.00</pIPI><vIPI>37.84</vIPI></IPITrib></IPI><PIS><PISAliq><CST>01</CST><vBC>378.42</vBC><pPIS>0.65</pPIS><vPIS>2.46</vPIS></PISAliq></PIS><COFINS><COFINSAliq><CST>01</CST><vBC>378.42</vBC><pCOFINS>3.00</pCOFINS><vCOFINS>11.35</vCOFINS></COFINSAliq></COFINS></imposto></det><det nItem=\"4\"><prod><cProd>000000000009682</cProd><cEAN /><xProd>BIC 16 POCOLOCO AZUL CACESS VERMELHO</xProd><NCM>87120010</NCM><CFOP>6101</CFOP><uCom>PC</uCom><qCom>2.0000</qCom><vUnCom>126.1400</vUnCom><vProd>252.28</vProd><cEANTrib /><uTrib>PC</uTrib><qTrib>2.0000</qTrib><vUnTrib>126.1400</vUnTrib><indTot>1</indTot></prod><imposto><ICMS><ICMS00><orig>0</orig><CST>00</CST><modBC>0</modBC><vBC>252.28</vBC><pICMS>7.00</pICMS><vICMS>17.66</vICMS></ICMS00></ICMS><IPI><cEnq>999</cEnq><IPITrib><CST>50</CST><vBC>252.28</vBC><pIPI>10.00</pIPI><vIPI>25.23</vIPI></IPITrib></IPI><PIS><PISAliq><CST>01</CST><vBC>252.28</vBC><pPIS>0.65</pPIS><vPIS>1.64</vPIS></PISAliq></PIS><COFINS><COFINSAliq><CST>01</CST><vBC>252.28</vBC><pCOFINS>3.00</pCOFINS><vCOFINS>7.57</vCOFINS></COFINSAliq></COFINS></imposto></det><det nItem=\"5\"><prod><cProd>000000000009683</cProd><cEAN /><xProd>BIC 16 POCOLOCO PRETO CACESS VERDE</xProd><NCM>87120010</NCM><CFOP>6101</CFOP><uCom>PC</uCom><qCom>3.0000</qCom><vUnCom>126.1400</vUnCom><vProd>378.42</vProd><cEANTrib /><uTrib>PC</uTrib><qTrib>3.0000</qTrib><vUnTrib>126.1400</vUnTrib><indTot>1</indTot></prod><imposto><ICMS><ICMS00><orig>0</orig><CST>00</CST><modBC>0</modBC><vBC>378.42</vBC><pICMS>7.00</pICMS><vICMS>26.49</vICMS></ICMS00></ICMS><IPI><cEnq>999</cEnq><IPITrib><CST>50</CST><vBC>378.42</vBC><pIPI>10.00</pIPI><vIPI>37.84</vIPI></IPITrib></IPI><PIS><PISAliq><CST>01</CST><vBC>378.42</vBC><pPIS>0.65</pPIS><vPIS>2.46</vPIS></PISAliq></PIS><COFINS><COFINSAliq><CST>01</CST><vBC>378.42</vBC><pCOFINS>3.00</pCOFINS><vCOFINS>11.35</vCOFINS></COFINSAliq></COFINS></imposto></det><total><ICMSTot><vBC>1387.54</vBC><vICMS>97.13</vICMS><vICMSDeson>0.00</vICMSDeson><vBCST>0.00</vBCST><vST>0.00</vST><vProd>1387.54</vProd><vFrete>0.00</vFrete><vSeg>0.00</vSeg><vDesc>0.00</vDesc><vII>0.00</vII><vIPI>138.75</vIPI><vPIS>9.02</vPIS><vCOFINS>41.62</vCOFINS><vOutro>0.00</vOutro><vNF>1526.29</vNF></ICMSTot></total><transp><modFrete>0</modFrete><transporta><CNPJ>22792561000103</CNPJ><xNome>TRANSMADRUGA  FRETE POR CONTA DO REMETENTE</xNome><IE>746011172114</IE><xEnder>RUA AGOSTINHO DE COLI</xEnder><xMun>ESTIVA GERBI</xMun><UF>SP</UF></transporta><veicTransp><placa>PNI9999</placa><UF>SP</UF></veicTransp><vol><qVol>11</qVol><esp>CAIXAS</esp><pesoB>53.900</pesoB></vol></transp><cobr><fat><nFat>000671</nFat><vOrig>1526.29</vOrig><vLiq>1526.29</vLiq></fat><dup><nDup>000671A</nDup><dVenc>2016-09-03</dVenc><vDup>1526.29</vDup></dup></cobr><infAdic><infCpl>Valor Aprox dos Tributos R$   49743  3585% Fonte IBPT   Em caso de apresentar defeitos, acionar a assistencia tecnica atraves do TEL 1938617977, eou email sac@smetalurgicacombr REDESPACHO TRANSMARINHO TRANSPORTES  FRETE P CONTA DO DESTINATARIO  AVENIDA PAPA JOAO PAULO I No 2258      VILA AEROPORTO    GUARULHOS    SP  CNPJ19440740000410  IE796194703113  CEP07170350</infCpl></infAdic></infNFe><Signature xmlns=\"http://www.w3.org/2000/09/xmldsig#\"><SignedInfo><CanonicalizationMethod Algorithm=\"http://www.w3.org/TR/2001/REC-xml-c14n-20010315\" /><SignatureMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#rsa-sha1\" /><Reference URI=\"#NFe35160824104582000114550010000006711333970182\"><Transforms><Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\" /><Transform Algorithm=\"http://www.w3.org/TR/2001/REC-xml-c14n-20010315\" /></Transforms><DigestMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#sha1\" /><DigestValue>J8js17sajM78C99ILo+Q30WDxoA=</DigestValue></Reference></SignedInfo><SignatureValue>Y42SPUCvRSopC9esdRSynt/ua24pkGezrWbG4U4upnKWx3sPFencePqK2K/0bQkIIwEqlM5u2V/GSBrt5w5vk1NVhOjjkKJQsoBqzZEeska8E8ktUiHLAjcFMyrE86OdPl8y49rVoh2gQf3fspzmgph+PrRpP55XiRV5RD04UTRoKvU1vzL6TcBzpYssGQ+ycLSgrUmLprQBxl6cgAeNjhJlZjFInTLJ2H99idkL7uJiMlmQqiFdINhRQ5HV4LPpLAVFE/DJS4s2ujhjONQsnumvSsuByo+49kjPkXgy1PoUhYnS9pvekPpzX0TxO/7FyZRQ4eKIeTYJRDESU4V3zQ==</SignatureValue><KeyInfo><X509Data><X509Certificate>MIIIWzCCBkOgAwIBAgIQT+7jkOGrPFDTLuhnAXSPuzANBgkqhkiG9w0BAQsFADB4MQswCQYDVQQGEwJCUjETMBEGA1UEChMKSUNQLUJyYXNpbDE2MDQGA1UECxMtU2VjcmV0YXJpYSBkYSBSZWNlaXRhIEZlZGVyYWwgZG8gQnJhc2lsIC0gUkZCMRwwGgYDVQQDExNBQyBDZXJ0aXNpZ24gUkZCIEc0MB4XDTE2MDIxMjAwMDAwMFoXDTE3MDIxMDIzNTk1OVowggEEMQswCQYDVQQGEwJCUjETMBEGA1UEChQKSUNQLUJyYXNpbDELMAkGA1UECBMCU1AxGDAWBgNVBAcUD1RBQk9BTyBEQSBTRVJSQTE2MDQGA1UECxQtU2VjcmV0YXJpYSBkYSBSZWNlaXRhIEZlZGVyYWwgZG8gQnJhc2lsIC0gUkZCMRYwFAYDVQQLFA1SRkIgZS1DTlBKIEExMSQwIgYDVQQLFBtBdXRlbnRpY2FkbyBwb3IgQVIgT0RMRVZBVEkxQzBBBgNVBAMTOkJJS0VTIFNQT1JUUyBCSUNJQ0xFVEFTIEUgQUNFU1NPUklPUyBFSVJFTEk6MjQxMDQ1ODIwMDAxMTQwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDCakh7sftKkck2y0k88cU+C9YcsdimLYegGk5/aAG0aqVYyB4FbNIaFbGnNDqBMVDbWxQqNFlYjzwNcOUOjh5IQys42+8ayrbOKIR/zbYE4JDEPD4kghlZDt4Z5htSBT12VL4VNVhaNQOeC5UJdbFESaBnHQcXXugTsA/4Nr7XOeZaWBi1Ae3LmDvhkoZklP03kLF4Urf9Rchz31Bm2TrkgPEVnfoSVgSRYaQyVfV0p+ROJFx3eP6M2h02JEGLLDJCaxcTfDtO96F6Zdxuv5EDf9IVMAAqtHySIuxlLW8G8wsBHcIOce/9soAs4BFNHuh6aAPFU0saeGY6cH62p3pFAgMBAAGjggNRMIIDTTCBtgYDVR0RBIGuMIGroD0GBWBMAQMEoDQEMjE4MDQxOTM1MDMwODY2NDc4NzYwMDAwMDAwMDAwMDAwMDAwMDAxNDM1MzUyNlNTUFNQoB0GBWBMAQMCoBQEElpJTERBIEJPUkdFUyBBTFZFU6AZBgVgTAEDA6AQBA4yNDEwNDU4MjAwMDExNKAXBgVgTAEDB6AOBAwwMDAwMDAwMDAwMDCBF2RpZWdvQHBsYW5lZmlzY28uY29tLmJyMAkGA1UdEwQCMAAwHwYDVR0jBBgwFoAULpHq1m3lslmC3DiFKXY0FlY80D4wDgYDVR0PAQH/BAQDAgXgMH8GA1UdIAR4MHYwdAYGYEwBAgEMMGowaAYIKwYBBQUHAgEWXGh0dHA6Ly9pY3AtYnJhc2lsLmNlcnRpc2lnbi5jb20uYnIvcmVwb3NpdG9yaW8vZHBjL0FDX0NlcnRpc2lnbl9SRkIvRFBDX0FDX0NlcnRpc2lnbl9SRkIucGRmMIIBFgYDVR0fBIIBDTCCAQkwV6BVoFOGUWh0dHA6Ly9pY3AtYnJhc2lsLmNlcnRpc2lnbi5jb20uYnIvcmVwb3NpdG9yaW8vbGNyL0FDQ2VydGlzaWduUkZCRzQvTGF0ZXN0Q1JMLmNybDBWoFSgUoZQaHR0cDovL2ljcC1icmFzaWwub3V0cmFsY3IuY29tLmJyL3JlcG9zaXRvcmlvL2xjci9BQ0NlcnRpc2lnblJGQkc0L0xhdGVzdENSTC5jcmwwVqBUoFKGUGh0dHA6Ly9yZXBvc2l0b3Jpby5pY3BicmFzaWwuZ292LmJyL2xjci9DZXJ0aXNpZ24vQUNDZXJ0aXNpZ25SRkJHNC9MYXRlc3RDUkwuY3JsMB0GA1UdJQQWMBQGCCsGAQUFBwMCBggrBgEFBQcDBDCBmwYIKwYBBQUHAQEEgY4wgYswXwYIKwYBBQUHMAKGU2h0dHA6Ly9pY3AtYnJhc2lsLmNlcnRpc2lnbi5jb20uYnIvcmVwb3NpdG9yaW8vY2VydGlmaWNhZG9zL0FDX0NlcnRpc2lnbl9SRkJfRzQucDdjMCgGCCsGAQUFBzABhhxodHRwOi8vb2NzcC5jZXJ0aXNpZ24uY29tLmJyMA0GCSqGSIb3DQEBCwUAA4ICAQBXx7YWXok8LkDcAUotqT1RPm4hSMcIcalt5eQ2y2YUznKAgeFMbm6eL/0bfFRP1s6oaRzzimPNrhSWSkdhm4tPuc37e8kL9e4xrVdoWY7ZrzPq1pmqYkHtDl0jLMFlqa2Ag9Jt1cen+Cx4C75uLcNnnDgdPqbKAHuhBpaS0zdYJHWdTOMKP7Y5tZM4JCVL6O0Zpk1+lapsAjTFKE7M3C4ZNRsk4wjCNDmI8zAmZWBTXpuE0UjTqqDdi0dlXTLEHevkSlBw4V5dxGZrp230BfQLaqTlf4QJ5W5QDCTSe1GYMWoJQnPWqpBFaIS20ZdHHy/H0hOKpEUftpbqReS1B4530lqCrQINcLcChtTj2o6ggtF/R+i/nuuAwcy1KuEaTxNZOCZk87Cr5kidgIqq5lA3Yuw4b7KQW7d7KJV86oOI+unvPfPQvYiuduoVs8gz+moDVYKtBgqZ+WeY7X4RppzhoumI8+V1W2cE9WILn63xXG0a3Y9XjfWxBtc5kj4wKD3frgurpWECYJXpcJ8YoUVuWzTD38rsQd6i9X/2gD7rLAVfCwfOXBp7F/u4FaOjYMYNJ1gxz0K8LR5uVqt/XUqdJxyuB62bN0BrWTO9yxTd2aaBcS4kIr716zyvxpeYbtxIjtlkYKFwlWtwfwJmVP9uSuD7Gxwd7s8Axdac5J7CjA==</X509Certificate></X509Data></KeyInfo></Signature></NFe><protNFe versao=\"3.10\" xmlns=\"http://www.portalfiscal.inf.br/nfe\"><infProt><tpAmb>1</tpAmb><verAplic>SP_NFE_PL_008i2</verAplic><chNFe>35160824104582000114550010000006711333970182</chNFe><dhRecbto>2016-08-24T15:00:34-03:00</dhRecbto><nProt>135160523776426</nProt><digVal>J8js17sajM78C99ILo+Q30WDxoA=</digVal><cStat>100</cStat><xMotivo>Autorizado o uso da NF-e</xMotivo></infProt></protNFe></nfeProc>";
            var xml = Utils.LerArquivo("Arquivos", "NFCe.xml");
            var retorno = servNfe.ConsultarPelaChave(xml, false, "65");
            Assert.IsNotNull(retorno);
        }

        [TestMethod]
        [Description("Inutilizar um numero de nota fiscal")]
        public void InutilizarUmNumeroDeNotaFDiscal()
        {
            //Descomentar para executar rotina
            //Esta rotina não deve ser executada automaticamente
            var c1 = ObterConfiguracao();
            var config = new Configurar(c1);
            var servNfe = new ServNFe4(config.EmissorConfig);
            var retorno = servNfe.Inutilizar("1778403800-0103", 19, "65", 1, 1, 3, "Ipsum lorem Lorem Ipsum reflect hujlenb");
            Assert.IsNotNull(retorno);
        }


        [TestMethod]
        public void MethodExtension()
        {
            var icms = new ICMSPart { modBC = DeterminacaoBaseIcms.DbiValorOperacao, modBCST = DeterminacaoBaseIcmsSt.DbisPauta };
            var t = icms.modBC();
        }

        [TestMethod]
        [Description("Obter dados de endereço do arquivo Json")]
        public void ObterDadosEnderecadorJson()
        {
            var c1 = ObterConfiguracao();
            var config = new Configurar(c1);
            Assert.IsNotNull(config.EmissorConfig.ConfigEnderecoServico.UrlsNFe);
        }

        [TestMethod]
        [Description("Verificar criação da DANFE Emissão Normal NFCe")]
        public void ObterDanfeNFCeModelo65()
        {

            var xml = "<enviNFe xmlns=\"http://www.portalfiscal.inf.br/nfe\" versao=\"4.00\"><idLote>1</idLote><indSinc>1</indSinc><NFe><infNFe versao=\"4.00\" Id=\"NFe29200317784038000103650070000016771000016784\"><ide><cUF>29</cUF><cNF>00001678</cNF><natOp>Venda de mercadoria adquirida ou recebida de terceiros</natOp><mod>65</mod><serie>7</serie><nNF>1677</nNF><dhEmi>2020-03-25T09:53:29-03:00</dhEmi><tpNF>1</tpNF><idDest>1</idDest><cMunFG>2927408</cMunFG><tpImp>4</tpImp><tpEmis>1</tpEmis><cDV>4</cDV><tpAmb>2</tpAmb><finNFe>1</finNFe><indFinal>1</indFinal><indPres>1</indPres><procEmi>0</procEmi><verProc>4.00</verProc></ide><emit><CNPJ>17784038000103</CNPJ><xNome>KAP RIBEIRO COMERCIO DE BICICLETAS EIRELI</xNome><xFant>ANAILTON DE OLIVEIRA RIBEIRO</xFant><enderEmit><xLgr>Praça Dorival Caymmi</xLgr><nro>S/N</nro><xBairro>Itapuã</xBairro><cMun>2927408</cMun><xMun>Salvador</xMun><UF>BA</UF><CEP>41620500</CEP><cPais>1058</cPais><xPais>BRASIL</xPais></enderEmit><IE>107728249</IE><CRT>1</CRT></emit><det nItem=\"1\"><prod><cProd>001196</cProd><cEAN>SEM GTIN</cEAN><xProd>NOTA FISCAL EMITIDA EM AMBIENTE DE HOMOLOGACAO - SEM VALOR FISCAL</xProd><NCM>87120010</NCM><CFOP>5102</CFOP><uCom>UN</uCom><qCom>1.0000</qCom><vUnCom>78.7200000000</vUnCom><vProd>78.72</vProd><cEANTrib>SEM GTIN</cEANTrib><uTrib>UN</uTrib><qTrib>1.0000</qTrib><vUnTrib>78.7200000000</vUnTrib><indTot>1</indTot></prod><imposto><vTotTrib>8.57</vTotTrib><ICMS><ICMSSN102><orig>0</orig><CSOSN>103</CSOSN></ICMSSN102></ICMS></imposto></det><total><ICMSTot><vBC>0.00</vBC><vICMS>0.00</vICMS><vICMSDeson>0.00</vICMSDeson><vFCPUFDest>0.00</vFCPUFDest><vICMSUFDest>0.00</vICMSUFDest><vICMSUFRemet>0.00</vICMSUFRemet><vFCP>0.00</vFCP><vBCST>0.00</vBCST><vST>0.00</vST><vFCPST>0.00</vFCPST><vFCPSTRet>0.00</vFCPSTRet><vProd>78.72</vProd><vFrete>0.00</vFrete><vSeg>0.00</vSeg><vDesc>0.00</vDesc><vII>0.00</vII><vIPI>0.00</vIPI><vIPIDevol>0.00</vIPIDevol><vPIS>0.00</vPIS><vCOFINS>0.00</vCOFINS><vOutro>0.00</vOutro><vNF>78.72</vNF><vTotTrib>8.57</vTotTrib></ICMSTot></total><transp><modFrete>9</modFrete></transp><pag><detPag><tPag>03</tPag><vPag>26.24</vPag><card><tpIntegra>2</tpIntegra></card></detPag><detPag><tPag>03</tPag><vPag>26.24</vPag><card><tpIntegra>2</tpIntegra></card></detPag><detPag><tPag>03</tPag><vPag>26.24</vPag><card><tpIntegra>2</tpIntegra></card></detPag><vTroco>0.00</vTroco></pag><infAdic><infCpl>Trib aprox: 8,57 Federal, 0 Estadual e Municipal: 0 Fonte: 6A098E</infCpl></infAdic></infNFe><infNFeSupl><qrCode>http://hnfe.sefaz.ba.gov.br/servicos/nfce/modulos/geral/NFCEC_consulta_chave_acesso.aspx?p=29200317784038000103650070000016771000016784|2|2|1|db3cca936927d39c2df6f708f520314021df1ce1</qrCode><urlChave>http://hinternet.sefaz.ba.gov.br/nfce/consulta</urlChave></infNFeSupl><Signature xmlns=\"http://www.w3.org/2000/09/xmldsig#\"><SignedInfo><CanonicalizationMethod Algorithm=\"http://www.w3.org/TR/2001/REC-xml-c14n-20010315\" /><SignatureMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#rsa-sha1\" /><Reference URI=\"#NFe29200317784038000103650070000016771000016784\"><Transforms><Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\" /><Transform Algorithm=\"http://www.w3.org/TR/2001/REC-xml-c14n-20010315\" /></Transforms><DigestMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#sha1\" /><DigestValue>cC7Ut5V0jfMjsBYvNbJVTIew9qc=</DigestValue></Reference></SignedInfo><SignatureValue>L9QJ2RbC3NbPjmqSjHmLu9Azr5eNmrqOIm7fw5Z0YkA5g9QBe0JNN59ySWTitW8l+9JaZw0pOqcQmtzCoCT8mscBI1arTy/PfU4F69vXAkMBsMfHyyRA/S0aprSxAGexAWWbgkHKk8rpETDVHMl71ufWIN6Lt8PKIwVMsGwuedqHqzVEudS7z5hrHwsmgWUcjHc6bxOry8XtrFavZECRYjiw43eO9hZ7FNBgDygLSatlZ8uptjHOLSMJjvBo76rh+WgSQw/X7/GszS5QIejInLoikgRQqR4iHDzcqNKQWjqXT1Qn7Jjv7wmo6LfyfNqPDhUYkFCI0XvgGd6KhR/HHA==</SignatureValue><KeyInfo><X509Data><X509Certificate>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</X509Certificate></X509Data></KeyInfo></Signature></NFe></enviNFe>";
            var nfe = Utils.XmlStringParaClasse<enviNFe>(xml);
            var danfe = new DanfeNFCe(nfe.NFe[0], false, Status.Autorizada, "55512121121211", "Emissor Fiscal DSBR Brasil - www.dsbrbrasil.com.br");
            IDanfeHtml d1 = new DanfeNFCeHtml(danfe, TipoPapelNFCe.Mm80);
            var doc = d1.ObterDocHtml();
            Utils.EscreverArquivo("D:\\", "NFce.htm", doc.Html);

        }

         

        [TestMethod]
        [Description("Verificar criação da DANFE Emissão Normal NFe. O objetivo é verificar se as DANFES foram impressas corretamente")]
        public void ObterDanfeNFeModelo55()
        {
             
            var listNfe = new List<string>();
            listNfe.Add("<NFe xmlns=\"http://www.portalfiscal.inf.br/nfe\"><infNFe versao=\"4.00\" Id=\"NFe53201233683111000280550010001938771991938775\"><ide><cUF>53</cUF><cNF>99193877</cNF><natOp>PRESTACAO DE SERVICO</natOp><mod>55</mod><serie>1</serie><nNF>193877</nNF><dhEmi>2020-12-21T00:00:00-03:00</dhEmi><tpNF>1</tpNF><idDest>2</idDest><cMunFG>5300108</cMunFG><tpImp>1</tpImp><tpEmis>1</tpEmis><cDV>5</cDV><tpAmb>1</tpAmb><finNFe>1</finNFe><indFinal>1</indFinal><indPres>1</indPres><procEmi>0</procEmi><verProc>4.00</verProc></ide><emit><CNPJ>33683111000280</CNPJ><xNome>BRASILIA</xNome><enderEmit><xLgr>SGAN L2 Norte Quadra 601 Modulo G</xLgr><nro>0</nro><xBairro>NI</xBairro><cMun>5300108</cMun><xMun>Brasilia</xMun><UF>DF</UF><CEP>70836900</CEP></enderEmit><IE>0733474300294</IE><IM>0733474300294</IM><CNAE>6311900</CNAE><CRT>3</CRT></emit><dest><CNPJ>15180714000104</CNPJ><xNome>UNIVERSIDADE FEDERAL DA BAHIA- UFBA</xNome><enderDest><xLgr>RUA AUGUSTO VIANA</xLgr><nro>SN</nro><xBairro>CANELA</xBairro><cMun>2927408</cMun><xMun>SALVADOR</xMun><UF>BA</UF><CEP>40170115</CEP></enderDest><indIEDest>9</indIEDest></dest><det nItem=\"1\"><prod><cProd>14585</cProd><cEAN>SEM GTIN</cEAN><xProd>Certificado Digital - Pessoa Fisica A3 de 3 anos com Token</xProd><NCM>00</NCM><CFOP>6933</CFOP><uCom>Serv</uCom><qCom>2.0000</qCom><vUnCom>256.0000</vUnCom><vProd>512.00</vProd><cEANTrib>SEM GTIN</cEANTrib><uTrib>Serv</uTrib><qTrib>2.0000</qTrib><vUnTrib>256.0000</vUnTrib><indTot>0</indTot></prod><imposto><ISSQN><vBC>0.00</vBC><vAliq>0.00</vAliq><vISSQN>0.00</vISSQN><cMunFG>5300108</cMunFG><cListServ>01.03</cListServ><indISS>5</indISS><cMun>5300108</cMun><indIncentivo>2</indIncentivo></ISSQN><PIS><PISAliq><CST>01</CST><vBC>512.00</vBC><pPIS>0.65</pPIS><vPIS>3.33</vPIS></PISAliq></PIS><COFINS><COFINSAliq><CST>01</CST><vBC>512.00</vBC><pCOFINS>3.00</pCOFINS><vCOFINS>15.36</vCOFINS></COFINSAliq></COFINS></imposto></det><det nItem=\"2\"><prod><cProd>14584</cProd><cEAN>SEM GTIN</cEAN><xProd>Certificado Digital - Pessoa Fisica A3 de 3 anos</xProd><NCM>00</NCM><CFOP>6933</CFOP><uCom>Serv</uCom><qCom>1.0000</qCom><vUnCom>206.0000</vUnCom><vProd>206.00</vProd><cEANTrib>SEM GTIN</cEANTrib><uTrib>Serv</uTrib><qTrib>1.0000</qTrib><vUnTrib>206.0000</vUnTrib><indTot>0</indTot></prod><imposto><ISSQN><vBC>0.00</vBC><vAliq>0.00</vAliq><vISSQN>0.00</vISSQN><cMunFG>5300108</cMunFG><cListServ>01.03</cListServ><indISS>5</indISS><cMun>5300108</cMun><indIncentivo>2</indIncentivo></ISSQN><PIS><PISAliq><CST>01</CST><vBC>206.00</vBC><pPIS>0.65</pPIS><vPIS>1.34</vPIS></PISAliq></PIS><COFINS><COFINSAliq><CST>01</CST><vBC>206.00</vBC><pCOFINS>3.00</pCOFINS><vCOFINS>6.18</vCOFINS></COFINSAliq></COFINS></imposto></det><total><ICMSTot><vBC>0</vBC><vICMS>0</vICMS><vICMSDeson>0</vICMSDeson><vFCP>0</vFCP><vBCST>0</vBCST><vST>0</vST><vFCPST>0</vFCPST><vFCPSTRet>0</vFCPSTRet><vProd>0</vProd><vFrete>0</vFrete><vSeg>0</vSeg><vDesc>0</vDesc><vII>0</vII><vIPI>0</vIPI><vIPIDevol>0</vIPIDevol><vPIS>0</vPIS><vCOFINS>0</vCOFINS><vOutro>0</vOutro><vNF>718.00</vNF></ICMSTot><ISSQNtot><vServ>718.00</vServ><vPIS>4.67</vPIS><vCOFINS>21.54</vCOFINS><dCompet>2020-12-21</dCompet></ISSQNtot><retTrib><vRetPIS>4.67</vRetPIS><vRetCOFINS>21.54</vRetCOFINS><vRetCSLL>7.18</vRetCSLL><vBCIRRF>718.00</vBCIRRF><vIRRF>34.47</vIRRF></retTrib></total><transp><modFrete>9</modFrete></transp><pag><detPag><tPag>15</tPag><vPag>718.00</vPag></detPag><vTroco>0</vTroco></pag><infAdic><infCpl>CONTRATO: 84745 OBSERVACAO: Mes referencia: 10/2020 Numero do contrato: 80705 Nao reter ISS. Imunidade Tributaria concedida pelo STF atraves da decisao da ACO n 2.658 de 06/04/2018, fundamentada no art. 150, inciso VI, alinea a da CF, e reconhecida pelo GDF por meio da publicacao do Ato Declaratorio n 622 - NUBEF/GEESP/COTRI/SUREC/SEF/SEEC, de 04/10/2019.</infCpl></infAdic></infNFe><ns2:Signature xmlns:ns2=\"http://www.w3.org/2000/09/xmldsig#\"><ns2:SignedInfo><ns2:CanonicalizationMethod Algorithm=\"http://www.w3.org/TR/2001/REC-xml-c14n-20010315\"/><ns2:SignatureMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#rsa-sha1\"/><ns2:Reference URI=\"#NFe53201233683111000280550010001938771991938775\"><ns2:Transforms><ns2:Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\"/><ns2:Transform Algorithm=\"http://www.w3.org/TR/2001/REC-xml-c14n-20010315\"/></ns2:Transforms><ns2:DigestMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#sha1\"/><ns2:DigestValue>gnNd7eRF/OPzbASrOYQObX5n1iU=</ns2:DigestValue></ns2:Reference></ns2:SignedInfo><ns2:SignatureValue>bFS4+P6AhGBQxdnHyhnEWFpQK56fmSj4EfLIOLDNGQIgyOUlSVGXozJZZb4bFEyQMkLGTKkVo63rXfaMoyAat8GVXATrX83J0LyuoiHCaOAe3XlTvZhIVn5MwhXohy2oAvxcqboEGoSvrKKwzQqTPHJYo3VuLTG9nlYxix2/hCg++vuuJ3m6ym2V1UYzEmd3yxwRfWSnxb8ee4JjhZtBTJukASRhi23gO/DNXTxRBjMDwy8+Eo8KEEXEnhd4tJumwwtFA7pZrXAAIQ9tOkeVOJPFBJtmfJ1cTZZO+UHuAvWRcV/LfLUUa1cYs9YPH8mfZ9Zojy0IqcQBMwVc25rcXw==</ns2:SignatureValue><ns2:KeyInfo><ns2:X509Data><ns2:X509Certificate>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</ns2:X509Certificate></ns2:X509Data></ns2:KeyInfo></ns2:Signature></NFe>");
            listNfe.Add("<NFe xmlns=\"http://www.portalfiscal.inf.br/nfe\"><infNFe versao=\"4.00\" Id=\"NFe29200717784038000103550090000000831000000840\"><ide><cUF>29</cUF><cNF>00000084</cNF><natOp>VENDA</natOp><mod>55</mod><serie>9</serie><nNF>83</nNF><dhEmi>2020-07-22T21:43:31-03:00</dhEmi><tpNF>1</tpNF><idDest>1</idDest><cMunFG>2927408</cMunFG><tpImp>1</tpImp><tpEmis>1</tpEmis><cDV>0</cDV><tpAmb>2</tpAmb><finNFe>1</finNFe><indFinal>1</indFinal><indPres>1</indPres><procEmi>0</procEmi><verProc>SgOne 1.19.2</verProc></ide><emit><CNPJ>17784038000103</CNPJ><xNome>ANAILTON DE OLIVEIRA RIBEIRO</xNome><xFant>DUCHA BIKES</xFant><enderEmit><xLgr>Caminho 3</xLgr><nro>S/N</nro><xCpl>XXXX</xCpl><xBairro>Nova Brasília de Itapuã</xBairro><cMun>2927408</cMun><xMun>Salvador</xMun><UF>BA</UF><CEP>41611043</CEP><cPais>1058</cPais><xPais>BRASIL</xPais></enderEmit><IE>107728249</IE><CRT>1</CRT></emit><dest><CPF>12312312387</CPF><xNome>NF-E EMITIDA EM AMBIENTE DE HOMOLOGACAO - SEM VALOR FISCAL</xNome><enderDest><xLgr>Rua Antonio de Souza</xLgr><nro>SN</nro><xCpl>EDF</xCpl><xBairro>Armacao</xBairro><cMun>2927408</cMun><xMun>Salvador</xMun><UF>BA</UF><CEP>41750320</CEP><cPais>1058</cPais><xPais>BRASIL</xPais></enderDest><indIEDest>9</indIEDest></dest><autXML><CNPJ>13937073000156</CNPJ></autXML><det nItem=\"1\"><prod><cProd>004829</cProd><cEAN>SEM GTIN</cEAN><xProd>NOTA FISCAL EMITIDA EM AMBIENTE DE HOMOLOGACAO - SEM VALOR FISCAL</xProd><NCM>85171211</NCM><CFOP>5102</CFOP><uCom>UN</uCom><qCom>1.0000</qCom><vUnCom>1.0000000000</vUnCom><vProd>1.00</vProd><cEANTrib>SEM GTIN</cEANTrib><uTrib>UN</uTrib><qTrib>1.0000</qTrib><vUnTrib>1.0000000000</vUnTrib><vFrete>3.00</vFrete><indTot>1</indTot></prod><imposto><vTotTrib>0.34</vTotTrib><ICMS><ICMSSN102><orig>0</orig><CSOSN>102</CSOSN></ICMSSN102></ICMS><PIS><PISOutr><CST>99</CST><vBC>4.00</vBC><pPIS>0.0000</pPIS><vPIS>0.00</vPIS></PISOutr></PIS><COFINS><COFINSOutr><CST>99</CST><vBC>0.00</vBC><pCOFINS>0.0000</pCOFINS><vCOFINS>0.00</vCOFINS></COFINSOutr></COFINS></imposto></det><total><ICMSTot><vBC>0.00</vBC><vICMS>0.00</vICMS><vICMSDeson>0.00</vICMSDeson><vFCPUFDest>0.00</vFCPUFDest><vICMSUFDest>0.00</vICMSUFDest><vICMSUFRemet>0.00</vICMSUFRemet><vFCP>0.00</vFCP><vBCST>0.00</vBCST><vST>0.00</vST><vFCPST>0.00</vFCPST><vFCPSTRet>0.00</vFCPSTRet><vProd>1.00</vProd><vFrete>3.00</vFrete><vSeg>0.00</vSeg><vDesc>0.00</vDesc><vII>0.00</vII><vIPI>0.00</vIPI><vIPIDevol>0.00</vIPIDevol><vPIS>0.00</vPIS><vCOFINS>0.00</vCOFINS><vOutro>0.00</vOutro><vNF>4.00</vNF><vTotTrib>0.34</vTotTrib></ICMSTot></total><transp><modFrete>0</modFrete><transporta><CNPJ>84097378000145</CNPJ><xNome>TRANSPORTADORA TESTE</xNome><xEnder>Rua do Lagarto Azul</xEnder><xMun>Salvador</xMun><UF>BA</UF></transporta><veicTransp><placa>OIU2356</placa><UF>BA</UF></veicTransp><vol><qVol>1</qVol><nVol>1</nVol><pesoL>2.000</pesoL><pesoB>4.000</pesoB></vol></transp><cobr><fat><nFat>4857</nFat><vOrig>4.00</vOrig><vLiq>4.00</vLiq></fat><dup><nDup>001</nDup><dVenc>2020-07-22</dVenc><vDup>4.00</vDup></dup></cobr><pag><detPag><tPag>01</tPag><vPag>4.00</vPag></detPag><vTroco>0.00</vTroco></pag><infAdic><infCpl>Trib aprox: 0,34 Federal, 0 Estadual e Municipal: 0 Fonte: D26078Documento emitido por ME ou EPP optante pelo simples nacional.Não gera direito a crédito fiscal de ipi.</infCpl></infAdic></infNFe><Signature xmlns=\"http://www.w3.org/2000/09/xmldsig#\"><SignedInfo><CanonicalizationMethod Algorithm=\"http://www.w3.org/TR/2001/REC-xml-c14n-20010315\" /><SignatureMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#rsa-sha1\" /><Reference URI=\"#NFe29200717784038000103550090000000831000000840\"><Transforms><Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\" /><Transform Algorithm=\"http://www.w3.org/TR/2001/REC-xml-c14n-20010315\" /></Transforms><DigestMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#sha1\" /><DigestValue>uNLbRhat8zpYqwwzg7Q8f47gB8w=</DigestValue></Reference></SignedInfo><SignatureValue>1Hbaa53PFykTQmYiFr4/uePpzUDUsEuqucVS+9aepYAzqT3hUXN444yV6yHKE9aIpHLO9nYVbAFXwxdIZnf8iviHfugQPUi7SLoBGyQlUPVgGIPoYdM6UKztLttC/9/id0tl5Nf2kpD8QQUvMCHozC3xqVu4ocJ50v8YKT89n2rcRYNpaIUdRtJTJkGAwdBlRqPzRFaQ+qKHJlyq8EZ9IxKB5vfefY551UN87ds9mw93766YTiAsoQL5nQOLzXbSBqh1BHM85UWnYSWcnQEzJMae3qsKTfsS+D+SnsF+PoHT512y22XlePOhxoubGrjeuLitBI4ilo1hpfYyFq/POw==</SignatureValue><KeyInfo><X509Data><X509Certificate>MIIH8DCCBdigAwIBAgIQIqsksr/biIIyHfHtFpGK2DANBgkqhkiG9w0BAQsFADB1MQswCQYDVQQGEwJCUjETMBEGA1UEChMKSUNQLUJyYXNpbDE2MDQGA1UECxMtU2VjcmV0YXJpYSBkYSBSZWNlaXRhIEZlZGVyYWwgZG8gQnJhc2lsIC0gUkZCMRkwFwYDVQQDExBBQyBTSU5DT1IgUkZCIEc1MB4XDTIwMDEyNzE1MDY0MFoXDTIxMDEyNjE1MDY0MFowge4xCzAJBgNVBAYTAkJSMRMwEQYDVQQKDApJQ1AtQnJhc2lsMQswCQYDVQQIDAJCQTERMA8GA1UEBwwIU2FsdmFkb3IxNjA0BgNVBAsMLVNlY3JldGFyaWEgZGEgUmVjZWl0YSBGZWRlcmFsIGRvIEJyYXNpbCAtIFJGQjEWMBQGA1UECwwNUkZCIGUtQ05QSiBBMTEXMBUGA1UECwwOMDA1Nzg1MTAwMDAyMjExQTA/BgNVBAMMOEtBUCBSSUJFSVJPIENPTUVSQ0lPIERFIEJJQ0lDTEVUQVMgRUlSRUxJOjE3Nzg0MDM4MDAwMTAzMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA5gdhIoigf/9PV58KzEOhfjoKteL6IeeeTig30s5ivWzeexz29A3HRU9j+4kXz+lAB9psfKgGyC8yixO2rFI353mwlwoVs0jHHIHJmLxE3OE6WRSmhlYa1lcyitRsMWetnWpgL/n3eoC3J24uRNzjsBY4pIs4evWnRwIMgFGte3MKt3fEOACE2pCTKx1KxSJUztg54YU+ZfNHm0yycdWKgBJW8cBZ1uPmyphGt3g2srWZYI98BiA2xYNtuv6PFd6Qpu1lEdpo0ldBQU8xVnY1DxSHpM2I8HIL5UWIZexMugLGyhCNUnIs446cPTwMwFv1GNOman5P4N3FacNwicJ6kwIDAQABo4IDADCCAvwwgcMGA1UdEQSBuzCBuKA9BgVgTAEDBKA0BDIwNTA0MTk4MjAxOTY0MTQ5NTQxMDAwMDAwMDAwMDAwMDAwMDA4MzkzODM5NzVTU1BCQaAnBgVgTAEDAqAeBBxBTkFJTFRPTiBERSBPTElWRUlSQSBSSUJFSVJPoBkGBWBMAQMDoBAEDjE3Nzg0MDM4MDAwMTAzoBcGBWBMAQMHoA4EDDAwMDAwMDAwMDAwMIEacmVuYXRvY2FydmFsaG85OUBnbWFpbC5jb20wCQYDVR0TBAIwADAfBgNVHSMEGDAWgBRn50IRvvI4BhVJD4f/2gXeXY6UIjB4BgNVHSAEcTBvMG0GBmBMAQIBHDBjMGEGCCsGAQUFBwIBFlVodHRwOi8vaWNwLWJyYXNpbC5hY3NpbmNvci5jb20uYnIvcmVwb3NpdG9yaW8vZHBjL0FDX1NJTkNPUl9SRkIvRFBDX0FDX1NJTkNPUl9SRkIucGRmMIG2BgNVHR8Ega4wgaswVKBSoFCGTmh0dHA6Ly9pY3AtYnJhc2lsLmNlcnRpc2lnbi5jb20uYnIvcmVwb3NpdG9yaW8vbGNyL0FDU0lOQ09SUkZCRzUvTGF0ZXN0Q1JMLmNybDBToFGgT4ZNaHR0cDovL2ljcC1icmFzaWwub3V0cmFsY3IuY29tLmJyL3JlcG9zaXRvcmlvL2xjci9BQ1NJTkNPUlJGQkc1L0xhdGVzdENSTC5jcmwwDgYDVR0PAQH/BAQDAgXgMB0GA1UdJQQWMBQGCCsGAQUFBwMCBggrBgEFBQcDBDCBpQYIKwYBBQUHAQEEgZgwgZUwWwYIKwYBBQUHMAKGT2h0dHA6Ly9pY3AtYnJhc2lsLmFjc2luY29yLmNvbS5ici9yZXBvc2l0b3Jpby9jZXJ0aWZpY2Fkb3MvQUNfU0lOQ09SX1JGQl9HNS5wN2MwNgYIKwYBBQUHMAGGKmh0dHA6Ly9vY3NwLWFjLXNpbmNvci1yZmIuY2VydGlzaWduLmNvbS5icjANBgkqhkiG9w0BAQsFAAOCAgEAedMjZmWUustJVjHKupH+PwGReoj1+NaKCgiqk5yBma/r3sb35zrAiDES95WUX5yTr4qHaCfou2n3flGNQ1BASwQ3YDZ9k9iFat1D+/B4WUSJ6PWtvLLj9NAOrP2AzwIEsMY/pIPTmCxCSSYcelC8IMfW7Gh84QO08cnUdH9w6FVwcEWkn89Ygcz3m6i1uG6wenmKvqDvooR5uWy16ye70AuDtVI2W4vh3GGr1VPuYAQNMcJPwGiEcIfdnnMPjEzIwMpp2XpZQgCLb+MSiN81WWVlLM1G4oazmN54vONG0BOA7GV6+9kUiz/Fo0bAUd8v0gxuBNT3Z9pOAItoaAn/UESzBsvEevnb/CwX5Ir/46Phf5S+pYyFlibNf87iwOxxmGFLTDXNU4iWN8lAJikQ1FWdWkRV4g/2EsJfN/3Ip8jbizU9ODBh56vIdINRRmaiJoi7JkSK9Ed1N2L7ddGOfLKiMXl+rb90YXQx9EIlvSgHJhEI+fB+mhSAR3byvrMWkcWqjOaf58gfOdDKLJg5tojdWuxiXPApXmpukZ0y2bon2qUsTdDwbjeXusBn9EVH1dL+Nm+5cjQZkxT0a+WL72ayEP7i/G8yqqUvl5puzR6vKShYU9EzilF8Ve4jtmv1Yt99aRl7hkAa3pfaI/G99E4FFV1l7k9kD5FmrzpoPTQ=</X509Certificate></X509Data></KeyInfo></Signature></NFe>");
            listNfe.Add("<NFe xmlns=\"http://www.portalfiscal.inf.br/nfe\"><infNFe versao=\"4.00\" Id=\"NFe73190610835909000113550010000365221685090770\"><ide><cUF>43</cUF><cNF>68509077</cNF><natOp>VENDA DE MERCADORIAS E SERVICOS</natOp><mod>55</mod><serie>1</serie><nNF>36522</nNF><dhEmi>2019-06-11T17:00:55-03:00</dhEmi><tpNF>1</tpNF><idDest>2</idDest><cMunFG>4313409</cMunFG><tpImp>1</tpImp><tpEmis>1</tpEmis><cDV>0</cDV><tpAmb>2</tpAmb><finNFe>1</finNFe><indFinal>0</indFinal><indPres>1</indPres><procEmi>0</procEmi><verProc>1.1.78.0</verProc></ide><emit><CNPJ>10835909000113</CNPJ><xNome>KRAFCHINSKI, MORAES E LINARES LTDA</xNome><xFant>KRAFCHINSKI, MORAES E LINARES LTDA</xFant><enderEmit><xLgr>RUA GUIA LOPES</xLgr><nro>1280</nro><xBairro>RONDONIA</xBairro><cMun>4313409</cMun><xMun>NOVO HAMBURGO</xMun><UF>RS</UF><CEP>93415512</CEP><cPais>1058</cPais><xPais>BRASIL</xPais><fone>5130773010</fone></enderEmit><IE>0860452247</IE><CRT>3</CRT></emit><dest><CNPJ>32806205000155</CNPJ><xNome>BIKETOP COMERCIO E SERVICOS DE BICICLETAS EIRELI</xNome><enderDest><xLgr>ALTINO SERBETO DE BARROS</xLgr><nro>173</nro><xCpl>LOJA 01</xCpl><xBairro>PITUBA</xBairro><cMun>2927408</cMun><xMun>SALVADOR</xMun><UF>BA</UF><CEP>41830492</CEP><cPais>1058</cPais><xPais>BRASIL</xPais><fone>71988015174</fone></enderDest><indIEDest>1</indIEDest><IE>155731233</IE></dest><det nItem=\"1\"><prod><cProd>005110</cProd><cEAN>SEM GTIN</cEAN><xProd>CAMISA CANNONDALE PRETA/RAJADA CINZA LETRA AMARELA-ZIPER CURTO-MASC TAM G</xProd><NCM>61130000</NCM><CFOP>6102</CFOP><uCom>UN</uCom><qCom>1.0000</qCom><vUnCom>29.9900000000</vUnCom><vProd>29.99</vProd><cEANTrib>SEM GTIN</cEANTrib><uTrib>UN</uTrib><qTrib>1.0000</qTrib><vUnTrib>29.9900000000</vUnTrib><indTot>1</indTot></prod><imposto><ICMS><ICMS00><orig>0</orig><CST>00</CST><modBC>3</modBC><vBC>29.99</vBC><pICMS>7.0000</pICMS><vICMS>2.10</vICMS></ICMS00></ICMS><IPI><cEnq>999</cEnq><IPITrib><CST>50</CST><vBC>0.00</vBC><pIPI>0.0000</pIPI><vIPI>0.00</vIPI></IPITrib></IPI><PIS><PISAliq><CST>01</CST><vBC>29.99</vBC><pPIS>0.6500</pPIS><vPIS>0.19</vPIS></PISAliq></PIS><COFINS><COFINSAliq><CST>01</CST><vBC>29.99</vBC><pCOFINS>3.0000</pCOFINS><vCOFINS>0.90</vCOFINS></COFINSAliq></COFINS></imposto></det><det nItem=\"2\"><prod><cProd>005115</cProd><cEAN>SEM GTIN</cEAN><xProd>CAMISA ORBEA PRETA/AZUL/BRANCA-ZIPER CURTO- MASC - TAM G</xProd><NCM>61130000</NCM><CFOP>6102</CFOP><uCom>UN</uCom><qCom>1.0000</qCom><vUnCom>29.9900000000</vUnCom><vProd>29.99</vProd><cEANTrib>SEM GTIN</cEANTrib><uTrib>UN</uTrib><qTrib>1.0000</qTrib><vUnTrib>29.9900000000</vUnTrib><indTot>1</indTot></prod><imposto><ICMS><ICMS00><orig>0</orig><CST>00</CST><modBC>3</modBC><vBC>29.99</vBC><pICMS>7.0000</pICMS><vICMS>2.10</vICMS></ICMS00></ICMS><IPI><cEnq>999</cEnq><IPITrib><CST>50</CST><vBC>0.00</vBC><pIPI>0.0000</pIPI><vIPI>0.00</vIPI></IPITrib></IPI><PIS><PISAliq><CST>01</CST><vBC>29.99</vBC><pPIS>0.6500</pPIS><vPIS>0.19</vPIS></PISAliq></PIS><COFINS><COFINSAliq><CST>01</CST><vBC>29.99</vBC><pCOFINS>3.0000</pCOFINS><vCOFINS>0.90</vCOFINS></COFINSAliq></COFINS></imposto></det><det nItem=\"3\"><prod><cProd>005141</cProd><cEAN>SEM GTIN</cEAN><xProd>CAMISA SCOTT MITCHELTON PRETA LETRAS AMARELA/BRANCA-ZIPER CURTO-MASC TAM GG</xProd><NCM>61130000</NCM><CFOP>6102</CFOP><uCom>UN</uCom><qCom>1.0000</qCom><vUnCom>29.9900000000</vUnCom><vProd>29.99</vProd><cEANTrib>SEM GTIN</cEANTrib><uTrib>UN</uTrib><qTrib>1.0000</qTrib><vUnTrib>29.9900000000</vUnTrib><indTot>1</indTot></prod><imposto><ICMS><ICMS00><orig>0</orig><CST>00</CST><modBC>3</modBC><vBC>29.99</vBC><pICMS>7.0000</pICMS><vICMS>2.10</vICMS></ICMS00></ICMS><IPI><cEnq>999</cEnq><IPITrib><CST>50</CST><vBC>0.00</vBC><pIPI>0.0000</pIPI><vIPI>0.00</vIPI></IPITrib></IPI><PIS><PISAliq><CST>01</CST><vBC>29.99</vBC><pPIS>0.6500</pPIS><vPIS>0.19</vPIS></PISAliq></PIS><COFINS><COFINSAliq><CST>01</CST><vBC>29.99</vBC><pCOFINS>3.0000</pCOFINS><vCOFINS>0.90</vCOFINS></COFINSAliq></COFINS></imposto></det><det nItem=\"4\"><prod><cProd>004557</cProd><cEAN>5017915380603</cEAN><xProd>CAPACETE INFANTIL VERMELHO COELHOS (TAM P) KIDZAMO</xProd><NCM>65061000</NCM><CEST>0101300</CEST><CFOP>6102</CFOP><uCom>UN</uCom><qCom>1.0000</qCom><vUnCom>10.2500000000</vUnCom><vProd>10.25</vProd><cEANTrib>5017915380603</cEANTrib><uTrib>UN</uTrib><qTrib>1.0000</qTrib><vUnTrib>10.2500000000</vUnTrib><vDesc>1.15</vDesc><indTot>1</indTot></prod><imposto><ICMS><ICMS00><orig>2</orig><CST>00</CST><modBC>3</modBC><vBC>9.10</vBC><pICMS>4.0000</pICMS><vICMS>0.36</vICMS></ICMS00></ICMS><IPI><cEnq>999</cEnq><IPITrib><CST>50</CST><vBC>0.00</vBC><pIPI>0.0000</pIPI><vIPI>0.00</vIPI></IPITrib></IPI><PIS><PISAliq><CST>01</CST><vBC>9.10</vBC><pPIS>0.6500</pPIS><vPIS>0.06</vPIS></PISAliq></PIS><COFINS><COFINSAliq><CST>01</CST><vBC>9.10</vBC><pCOFINS>3.0000</pCOFINS><vCOFINS>0.27</vCOFINS></COFINSAliq></COFINS></imposto></det><det nItem=\"5\"><prod><cProd>004558</cProd><cEAN>4032611162262</cEAN><xProd>CAPACETE INFANTIL VERMELHO LISTRAS (TAM P) KIDZAMO</xProd><NCM>65061000</NCM><CEST>0101300</CEST><CFOP>6102</CFOP><uCom>UN</uCom><qCom>1.0000</qCom><vUnCom>10.2500000000</vUnCom><vProd>10.25</vProd><cEANTrib>4032611162262</cEANTrib><uTrib>UN</uTrib><qTrib>1.0000</qTrib><vUnTrib>10.2500000000</vUnTrib><vDesc>1.15</vDesc><indTot>1</indTot></prod><imposto><ICMS><ICMS00><orig>2</orig><CST>00</CST><modBC>3</modBC><vBC>9.10</vBC><pICMS>4.0000</pICMS><vICMS>0.36</vICMS></ICMS00></ICMS><IPI><cEnq>999</cEnq><IPITrib><CST>50</CST><vBC>0.00</vBC><pIPI>0.0000</pIPI><vIPI>0.00</vIPI></IPITrib></IPI><PIS><PISAliq><CST>01</CST><vBC>9.10</vBC><pPIS>0.6500</pPIS><vPIS>0.06</vPIS></PISAliq></PIS><COFINS><COFINSAliq><CST>01</CST><vBC>9.10</vBC><pCOFINS>3.0000</pCOFINS><vCOFINS>0.27</vCOFINS></COFINSAliq></COFINS></imposto></det><det nItem=\"6\"><prod><cProd>000217</cProd><cEAN>7898954164588</cEAN><xProd>CONDUITE TEFLON PRETO 20M</xProd><NCM>87149990</NCM><CEST>0100200</CEST><CFOP>6102</CFOP><uCom>RL</uCom><qCom>2.0000</qCom><vUnCom>8.4500000000</vUnCom><vProd>16.90</vProd><cEANTrib>7898954164588</cEANTrib><uTrib>RL</uTrib><qTrib>2.0000</qTrib><vUnTrib>8.4500000000</vUnTrib><vDesc>2.00</vDesc><indTot>1</indTot></prod><imposto><ICMS><ICMS00><orig>2</orig><CST>00</CST><modBC>3</modBC><vBC>14.90</vBC><pICMS>4.0000</pICMS><vICMS>0.60</vICMS></ICMS00></ICMS><IPI><cEnq>999</cEnq><IPITrib><CST>50</CST><vBC>0.00</vBC><pIPI>0.0000</pIPI><vIPI>0.00</vIPI></IPITrib></IPI><PIS><PISAliq><CST>01</CST><vBC>14.90</vBC><pPIS>0.6500</pPIS><vPIS>0.10</vPIS></PISAliq></PIS><COFINS><COFINSAliq><CST>01</CST><vBC>14.90</vBC><pCOFINS>3.0000</pCOFINS><vCOFINS>0.45</vCOFINS></COFINSAliq></COFINS></imposto></det><det nItem=\"7\"><prod><cProd>004233</cProd><cEAN>7891828009299</cEAN><xProd>FAROL LED RECARREGAVEL USB 180 LUMENS PRETO WS-929</xProd><NCM>85121000</NCM><CFOP>6102</CFOP><uCom>UN</uCom><qCom>5.0000</qCom><vUnCom>24.5000000000</vUnCom><vProd>122.50</vProd><cEANTrib>7891828009299</cEANTrib><uTrib>UN</uTrib><qTrib>5.0000</qTrib><vUnTrib>24.5000000000</vUnTrib><vDesc>11.25</vDesc><indTot>1</indTot></prod><imposto><ICMS><ICMS00><orig>2</orig><CST>00</CST><modBC>3</modBC><vBC>111.25</vBC><pICMS>4.0000</pICMS><vICMS>4.45</vICMS></ICMS00></ICMS><IPI><cEnq>999</cEnq><IPITrib><CST>50</CST><vBC>0.00</vBC><pIPI>0.0000</pIPI><vIPI>0.00</vIPI></IPITrib></IPI><PIS><PISAliq><CST>01</CST><vBC>111.25</vBC><pPIS>0.6500</pPIS><vPIS>0.72</vPIS></PISAliq></PIS><COFINS><COFINSAliq><CST>01</CST><vBC>111.25</vBC><pCOFINS>3.0000</pCOFINS><vCOFINS>3.34</vCOFINS></COFINSAliq></COFINS></imposto></det><det nItem=\"8\"><prod><cProd>004876</cProd><cEAN>SEM GTIN</cEAN><xProd>GPS CICLOCOMPUTADOR ATRIO IRON BL-091 (CONECTA COM STRAVA)</xProd><NCM>90292010</NCM><CFOP>6102</CFOP><uCom>UN</uCom><qCom>2.0000</qCom><vUnCom>124.9500000000</vUnCom><vProd>249.90</vProd><cEANTrib>SEM GTIN</cEANTrib><uTrib>UN</uTrib><qTrib>2.0000</qTrib><vUnTrib>124.9500000000</vUnTrib><indTot>1</indTot></prod><imposto><ICMS><ICMS00><orig>0</orig><CST>00</CST><modBC>3</modBC><vBC>249.90</vBC><pICMS>7.0000</pICMS><vICMS>17.49</vICMS></ICMS00></ICMS><IPI><cEnq>999</cEnq><IPITrib><CST>50</CST><vBC>0.00</vBC><pIPI>0.0000</pIPI><vIPI>0.00</vIPI></IPITrib></IPI><PIS><PISAliq><CST>01</CST><vBC>249.90</vBC><pPIS>0.6500</pPIS><vPIS>1.62</vPIS></PISAliq></PIS><COFINS><COFINSAliq><CST>01</CST><vBC>249.90</vBC><pCOFINS>3.0000</pCOFINS><vCOFINS>7.50</vCOFINS></COFINSAliq></COFINS></imposto></det><det nItem=\"9\"><prod><cProd>002264</cProd><cEAN>SEM GTIN</cEAN><xProd>KIT REFLETORES QUADRO/RODA + CAMPAINHA + ESPELHO</xProd><NCM>87149990</NCM><CFOP>6102</CFOP><uCom>UN</uCom><qCom>5.0000</qCom><vUnCom>2.8450000000</vUnCom><vProd>14.23</vProd><cEANTrib>SEM GTIN</cEANTrib><uTrib>UN</uTrib><qTrib>5.0000</qTrib><vUnTrib>2.8450000000</vUnTrib><vDesc>1.75</vDesc><indTot>1</indTot></prod><imposto><ICMS><ICMS00><orig>2</orig><CST>00</CST><modBC>3</modBC><vBC>12.48</vBC><pICMS>4.0000</pICMS><vICMS>0.50</vICMS></ICMS00></ICMS><IPI><cEnq>999</cEnq><IPITrib><CST>50</CST><vBC>0.00</vBC><pIPI>0.0000</pIPI><vIPI>0.00</vIPI></IPITrib></IPI><PIS><PISAliq><CST>01</CST><vBC>12.48</vBC><pPIS>0.6500</pPIS><vPIS>0.08</vPIS></PISAliq></PIS><COFINS><COFINSAliq><CST>01</CST><vBC>12.48</vBC><pCOFINS>3.0000</pCOFINS><vCOFINS>0.37</vCOFINS></COFINSAliq></COFINS></imposto></det><det nItem=\"10\"><prod><cProd>004804</cProd><cEAN>7891828010059</cEAN><xProd>LUVA MTB FECHADA (DEDO LONGO) GEL PRETA/CINZA TAM XL WS-1003</xProd><NCM>87149990</NCM><CFOP>6102</CFOP><uCom>UN</uCom><qCom>5.0000</qCom><vUnCom>17.9500000000</vUnCom><vProd>89.75</vProd><cEANTrib>7891828010059</cEANTrib><uTrib>UN</uTrib><qTrib>5.0000</qTrib><vUnTrib>17.9500000000</vUnTrib><vDesc>8.50</vDesc><indTot>1</indTot></prod><imposto><ICMS><ICMS00><orig>2</orig><CST>00</CST><modBC>3</modBC><vBC>81.25</vBC><pICMS>4.0000</pICMS><vICMS>3.25</vICMS></ICMS00></ICMS><IPI><cEnq>999</cEnq><IPITrib><CST>50</CST><vBC>0.00</vBC><pIPI>0.0000</pIPI><vIPI>0.00</vIPI></IPITrib></IPI><PIS><PISAliq><CST>01</CST><vBC>81.25</vBC><pPIS>0.6500</pPIS><vPIS>0.53</vPIS></PISAliq></PIS><COFINS><COFINSAliq><CST>01</CST><vBC>81.25</vBC><pCOFINS>3.0000</pCOFINS><vCOFINS>2.44</vCOFINS></COFINSAliq></COFINS></imposto></det><det nItem=\"11\"><prod><cProd>002669</cProd><cEAN>7908005901038</cEAN><xProd>PASTILHA FREIO DISCO MOD SHIMANO BS01 (QUADRADA)</xProd><NCM>87149490</NCM><CFOP>6102</CFOP><uCom>PR</uCom><qCom>100.0000</qCom><vUnCom>3.9500000000</vUnCom><vProd>395.00</vProd><cEANTrib>7908005901038</cEANTrib><uTrib>PR</uTrib><qTrib>100.0000</qTrib><vUnTrib>3.9500000000</vUnTrib><vDesc>245.49</vDesc><indTot>1</indTot></prod><imposto><ICMS><ICMS00><orig>2</orig><CST>00</CST><modBC>3</modBC><vBC>149.51</vBC><pICMS>4.0000</pICMS><vICMS>5.98</vICMS></ICMS00></ICMS><IPI><cEnq>999</cEnq><IPITrib><CST>50</CST><vBC>0.00</vBC><pIPI>0.0000</pIPI><vIPI>0.00</vIPI></IPITrib></IPI><PIS><PISAliq><CST>01</CST><vBC>149.51</vBC><pPIS>0.6500</pPIS><vPIS>0.97</vPIS></PISAliq></PIS><COFINS><COFINSAliq><CST>01</CST><vBC>149.51</vBC><pCOFINS>3.0000</pCOFINS><vCOFINS>4.49</vCOFINS></COFINSAliq></COFINS></imposto></det><det nItem=\"12\"><prod><cProd>005026</cProd><cEAN>SEM GTIN</cEAN><xProd>PEDAL CLIP MTB WELLGO M919 ALUM PRETO</xProd><NCM>87149910</NCM><CFOP>6102</CFOP><uCom>UN</uCom><qCom>1.0000</qCom><vUnCom>69.9500000000</vUnCom><vProd>69.95</vProd><cEANTrib>SEM GTIN</cEANTrib><uTrib>UN</uTrib><qTrib>1.0000</qTrib><vUnTrib>69.9500000000</vUnTrib><indTot>1</indTot></prod><imposto><ICMS><ICMS00><orig>0</orig><CST>00</CST><modBC>3</modBC><vBC>69.95</vBC><pICMS>4.0000</pICMS><vICMS>2.80</vICMS></ICMS00></ICMS><IPI><cEnq>999</cEnq><IPITrib><CST>50</CST><vBC>0.00</vBC><pIPI>0.0000</pIPI><vIPI>0.00</vIPI></IPITrib></IPI><PIS><PISAliq><CST>01</CST><vBC>69.95</vBC><pPIS>0.6500</pPIS><vPIS>0.45</vPIS></PISAliq></PIS><COFINS><COFINSAliq><CST>01</CST><vBC>69.95</vBC><pCOFINS>3.0000</pCOFINS><vCOFINS>2.10</vCOFINS></COFINSAliq></COFINS></imposto></det><det nItem=\"13\"><prod><cProd>002888</cProd><cEAN>7898665507032</cEAN><xProd>REFIL P/ MOCHILA DE HIDRATACAO 2 LITROS JW</xProd><NCM>42021220</NCM><CEST>1900400</CEST><CFOP>6102</CFOP><uCom>UN</uCom><qCom>2.0000</qCom><vUnCom>12.4500000000</vUnCom><vProd>24.90</vProd><cEANTrib>7898665507032</cEANTrib><uTrib>UN</uTrib><qTrib>2.0000</qTrib><vUnTrib>12.4500000000</vUnTrib><vDesc>2.50</vDesc><indTot>1</indTot></prod><imposto><ICMS><ICMS00><orig>2</orig><CST>00</CST><modBC>3</modBC><vBC>22.40</vBC><pICMS>4.0000</pICMS><vICMS>0.90</vICMS></ICMS00></ICMS><IPI><cEnq>999</cEnq><IPITrib><CST>50</CST><vBC>0.00</vBC><pIPI>0.0000</pIPI><vIPI>0.00</vIPI></IPITrib></IPI><PIS><PISAliq><CST>01</CST><vBC>22.40</vBC><pPIS>0.6500</pPIS><vPIS>0.15</vPIS></PISAliq></PIS><COFINS><COFINSAliq><CST>01</CST><vBC>22.40</vBC><pCOFINS>3.0000</pCOFINS><vCOFINS>0.67</vCOFINS></COFINSAliq></COFINS></imposto></det><det nItem=\"14\"><prod><cProd>005053</cProd><cEAN>SEM GTIN</cEAN><xProd>SAPATILHA MTB FEM CINZA/ROSA TAM 35 IMP</xProd><NCM>87149490</NCM><CFOP>6102</CFOP><uCom>PAR</uCom><qCom>1.0000</qCom><vUnCom>99.9500000000</vUnCom><vProd>99.95</vProd><cEANTrib>SEM GTIN</cEANTrib><uTrib>PAR</uTrib><qTrib>1.0000</qTrib><vUnTrib>99.9500000000</vUnTrib><indTot>1</indTot></prod><imposto><ICMS><ICMS00><orig>2</orig><CST>00</CST><modBC>3</modBC><vBC>99.95</vBC><pICMS>4.0000</pICMS><vICMS>4.00</vICMS></ICMS00></ICMS><IPI><cEnq>999</cEnq><IPITrib><CST>50</CST><vBC>0.00</vBC><pIPI>0.0000</pIPI><vIPI>0.00</vIPI></IPITrib></IPI><PIS><PISAliq><CST>01</CST><vBC>99.95</vBC><pPIS>0.6500</pPIS><vPIS>0.65</vPIS></PISAliq></PIS><COFINS><COFINSAliq><CST>01</CST><vBC>99.95</vBC><pCOFINS>3.0000</pCOFINS><vCOFINS>3.00</vCOFINS></COFINSAliq></COFINS></imposto></det><det nItem=\"15\"><prod><cProd>004989</cProd><cEAN>SEM GTIN</cEAN><xProd>SELIM MTB GTS AZUL</xProd><NCM>87149500</NCM><CFOP>6102</CFOP><uCom>UN</uCom><qCom>1.0000</qCom><vUnCom>7.4500000000</vUnCom><vProd>7.45</vProd><cEANTrib>SEM GTIN</cEANTrib><uTrib>UN</uTrib><qTrib>1.0000</qTrib><vUnTrib>7.4500000000</vUnTrib><vDesc>0.50</vDesc><indTot>1</indTot></prod><imposto><ICMS><ICMS00><orig>2</orig><CST>00</CST><modBC>3</modBC><vBC>6.95</vBC><pICMS>4.0000</pICMS><vICMS>0.28</vICMS></ICMS00></ICMS><IPI><cEnq>999</cEnq><IPITrib><CST>50</CST><vBC>0.00</vBC><pIPI>0.0000</pIPI><vIPI>0.00</vIPI></IPITrib></IPI><PIS><PISAliq><CST>01</CST><vBC>6.95</vBC><pPIS>0.6500</pPIS><vPIS>0.05</vPIS></PISAliq></PIS><COFINS><COFINSAliq><CST>01</CST><vBC>6.95</vBC><pCOFINS>3.0000</pCOFINS><vCOFINS>0.21</vCOFINS></COFINSAliq></COFINS></imposto></det><det nItem=\"16\"><prod><cProd>004990</cProd><cEAN>SEM GTIN</cEAN><xProd>SELIM MTB GTS LARANJA</xProd><NCM>87149500</NCM><CFOP>6102</CFOP><uCom>UN</uCom><qCom>1.0000</qCom><vUnCom>7.4500000000</vUnCom><vProd>7.45</vProd><cEANTrib>SEM GTIN</cEANTrib><uTrib>UN</uTrib><qTrib>1.0000</qTrib><vUnTrib>7.4500000000</vUnTrib><vDesc>0.50</vDesc><indTot>1</indTot></prod><imposto><ICMS><ICMS00><orig>2</orig><CST>00</CST><modBC>3</modBC><vBC>6.95</vBC><pICMS>4.0000</pICMS><vICMS>0.28</vICMS></ICMS00></ICMS><IPI><cEnq>999</cEnq><IPITrib><CST>50</CST><vBC>0.00</vBC><pIPI>0.0000</pIPI><vIPI>0.00</vIPI></IPITrib></IPI><PIS><PISAliq><CST>01</CST><vBC>6.95</vBC><pPIS>0.6500</pPIS><vPIS>0.05</vPIS></PISAliq></PIS><COFINS><COFINSAliq><CST>01</CST><vBC>6.95</vBC><pCOFINS>3.0000</pCOFINS><vCOFINS>0.21</vCOFINS></COFINSAliq></COFINS></imposto></det><det nItem=\"17\"><prod><cProd>004997</cProd><cEAN>SEM GTIN</cEAN><xProd>SELIM MTB GTS VERDE</xProd><NCM>87149500</NCM><CFOP>6102</CFOP><uCom>UN</uCom><qCom>1.0000</qCom><vUnCom>7.4500000000</vUnCom><vProd>7.45</vProd><cEANTrib>SEM GTIN</cEANTrib><uTrib>UN</uTrib><qTrib>1.0000</qTrib><vUnTrib>7.4500000000</vUnTrib><vDesc>0.50</vDesc><indTot>1</indTot></prod><imposto><ICMS><ICMS00><orig>2</orig><CST>00</CST><modBC>3</modBC><vBC>6.95</vBC><pICMS>4.0000</pICMS><vICMS>0.28</vICMS></ICMS00></ICMS><IPI><cEnq>999</cEnq><IPITrib><CST>50</CST><vBC>0.00</vBC><pIPI>0.0000</pIPI><vIPI>0.00</vIPI></IPITrib></IPI><PIS><PISAliq><CST>01</CST><vBC>6.95</vBC><pPIS>0.6500</pPIS><vPIS>0.05</vPIS></PISAliq></PIS><COFINS><COFINSAliq><CST>01</CST><vBC>6.95</vBC><pCOFINS>3.0000</pCOFINS><vCOFINS>0.21</vCOFINS></COFINSAliq></COFINS></imposto></det><det nItem=\"18\"><prod><cProd>004984</cProd><cEAN>SEM GTIN</cEAN><xProd>SELIM MTB GTS VERMELHO</xProd><NCM>87149500</NCM><CFOP>6102</CFOP><uCom>UN</uCom><qCom>1.0000</qCom><vUnCom>7.4500000000</vUnCom><vProd>7.45</vProd><cEANTrib>SEM GTIN</cEANTrib><uTrib>UN</uTrib><qTrib>1.0000</qTrib><vUnTrib>7.4500000000</vUnTrib><vDesc>0.50</vDesc><indTot>1</indTot></prod><imposto><ICMS><ICMS00><orig>2</orig><CST>00</CST><modBC>3</modBC><vBC>6.95</vBC><pICMS>4.0000</pICMS><vICMS>0.28</vICMS></ICMS00></ICMS><IPI><cEnq>999</cEnq><IPITrib><CST>50</CST><vBC>0.00</vBC><pIPI>0.0000</pIPI><vIPI>0.00</vIPI></IPITrib></IPI><PIS><PISAliq><CST>01</CST><vBC>6.95</vBC><pPIS>0.6500</pPIS><vPIS>0.05</vPIS></PISAliq></PIS><COFINS><COFINSAliq><CST>01</CST><vBC>6.95</vBC><pCOFINS>3.0000</pCOFINS><vCOFINS>0.21</vCOFINS></COFINSAliq></COFINS></imposto></det><det nItem=\"19\"><prod><cProd>004805</cProd><cEAN>7891828002610</cEAN><xProd>VISTA LIGHT USB (COMETA) JY-261</xProd><NCM>85121000</NCM><CFOP>6102</CFOP><uCom>UN</uCom><qCom>4.0000</qCom><vUnCom>14.2500000000</vUnCom><vProd>57.00</vProd><cEANTrib>7891828002610</cEANTrib><uTrib>UN</uTrib><qTrib>4.0000</qTrib><vUnTrib>14.2500000000</vUnTrib><vDesc>5.80</vDesc><indTot>1</indTot></prod><imposto><ICMS><ICMS00><orig>2</orig><CST>00</CST><modBC>3</modBC><vBC>51.20</vBC><pICMS>4.0000</pICMS><vICMS>2.05</vICMS></ICMS00></ICMS><IPI><cEnq>999</cEnq><IPITrib><CST>50</CST><vBC>0.00</vBC><pIPI>0.0000</pIPI><vIPI>0.00</vIPI></IPITrib></IPI><PIS><PISAliq><CST>01</CST><vBC>51.20</vBC><pPIS>0.6500</pPIS><vPIS>0.33</vPIS></PISAliq></PIS><COFINS><COFINSAliq><CST>01</CST><vBC>51.20</vBC><pCOFINS>3.0000</pCOFINS><vCOFINS>1.54</vCOFINS></COFINSAliq></COFINS></imposto></det><total><ICMSTot><vBC>998.76</vBC><vICMS>50.16</vICMS><vICMSDeson>0.00</vICMSDeson><vFCP>0.00</vFCP><vBCST>0.00</vBCST><vST>0.00</vST><vFCPST>0.00</vFCPST><vFCPSTRet>0.00</vFCPSTRet><vProd>1280.35</vProd><vFrete>0.00</vFrete><vSeg>0.00</vSeg><vDesc>281.59</vDesc><vII>0.00</vII><vIPI>0.00</vIPI><vIPIDevol>0.00</vIPIDevol><vPIS>6.49</vPIS><vCOFINS>29.98</vCOFINS><vOutro>0.00</vOutro><vNF>998.76</vNF><vTotTrib>0.00</vTotTrib></ICMSTot></total><transp><modFrete>0</modFrete><transporta><CNPJ>17463456003025</CNPJ><xNome>PATRUS</xNome><IE>0860423387</IE><xEnder>RUA PAU BRASIL 1174</xEnder><xMun>NOVO HAMBURGO</xMun><UF>RS</UF></transporta><vol><qVol>3</qVol><pesoL>15.000</pesoL><pesoB>15.000</pesoB></vol></transp><cobr><fat><nFat>036522</nFat><vOrig>998.76</vOrig><vLiq>998.76</vLiq></fat><dup><nDup>001</nDup><dVenc>2019-08-01</dVenc><vDup>332.92</vDup></dup><dup><nDup>002</nDup><dVenc>2019-09-01</dVenc><vDup>332.92</vDup></dup><dup><nDup>003</nDup><dVenc>2019-10-01</dVenc><vDup>332.92</vDup></dup></cobr><pag><detPag><tPag>14</tPag><vPag>998.76</vPag></detPag></pag><infAdic><infCpl>Valor Total dos Tributos: R$ 0,00 Fonte: IBPT;Ped.: 139255 Cond.: 401-PRAZO PROMOCAO 2 Vend.: Sergio Valenca</infCpl></infAdic></infNFe><Signature xmlns=\"http://www.w3.org/2000/09/xmldsig#\"><SignedInfo><CanonicalizationMethod Algorithm=\"http://www.w3.org/TR/2001/REC-xml-c14n-20010315\" /><SignatureMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#rsa-sha1\" /><Reference URI=\"#NFe43190610835909000113550010000365221685090770\"><Transforms><Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\" /><Transform Algorithm=\"http://www.w3.org/TR/2001/REC-xml-c14n-20010315\" /></Transforms><DigestMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#sha1\" /><DigestValue>1ZxXs8NY8nKY1PKnmTZFwXW2VxY=</DigestValue></Reference></SignedInfo><SignatureValue>flcdgxaw/BCzoubo/Q74SlFMrc1tETNLqfWqxd3EGWV5u1u5Bo6DBiCeYPyegVWgQNLYOH1PTTn/hM+4sdvID8PviM0m4ZskRSYDvB8pOIGQY9yX9lZbkVRiljP5+tDSeB+fiXkb0rwlQlu1V/EMNtP0PTOlo678rtiKhX73q5kfhI3OTpXTfCF39eNtssiiARGBq3suSg76h9tyAi5Ig/P04HtLHEJ6Ib+pJOwwhyvOKzooDEEUo+5U1RgYziNYioJhOGTPUfQFZ35LT+VSLsWfHxgFCLD6hHOkSEYRiqebXyW9c0dMAh9EcjNUUdIJu8wzwVtrtKSlIWdz1/s6ug==</SignatureValue><KeyInfo><X509Data><X509Certificate>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</X509Certificate></X509Data></KeyInfo></Signature></NFe>");

            foreach (var item in listNfe)
            {
                var nfe = Utils.XmlStringParaClasse<NFe>(item);
                var danfe = new DanfeNFe(nfe, Status.Autorizada, "55512121121211", "Emissor Fiscal DSBR Brasil - www.dsbrbrasil.com.br");
                IDanfeHtml d1 = new DanfeNFeHtml(danfe);
                var doc = d1.ObterDocHtml();
                var nomeArquivo = $"danfe {nfe.infNFe.Id}.html";
                Utils.DelatarArquivo("D:\\", nomeArquivo);
                Utils.EscreverArquivo("D:\\", nomeArquivo, doc.Html);
            }
             


        }



        [TestMethod]
        [Description("Transmitir uma Nota Fiscal NFCe compactada usando uma string XMl")]
        public void TransmitirNotaFiscalCompactadoUsandoUmaStringXml()
        {
            var c1 = ObterConfiguracao();
            var config = new Configurar(c1);
            var servNfe = new ServNFe4(config.EmissorConfig);
            var xml =
                    "<NFe xmlns=\"http://www.portalfiscal.inf.br/nfe\"><infNFe versao=\"4.00\"><ide><cUF>29</cUF><cNF>1712</cNF><natOp>Venda de mercadoria adquirida ou recebida de terceiros</natOp><mod>65</mod><serie>7</serie><nNF>1711</nNF><dhEmi>2020-04-09T14:24:30-03:00</dhEmi><tpNF>1</tpNF><idDest>1</idDest><cMunFG>2927408</cMunFG><tpImp>4</tpImp><tpEmis>1</tpEmis><cDV>0</cDV><tpAmb>2</tpAmb><finNFe>1</finNFe><indFinal>1</indFinal><indPres>1</indPres><procEmi>0</procEmi><verProc>4.00</verProc></ide><emit><CNPJ>17784038000103</CNPJ><xNome>KAP RIBEIRO COMERCIO DE BICICLETAS EIRELI</xNome><xFant>ANAILTON DE OLIVEIRA RIBEIRO</xFant><enderEmit><xLgr>Praça Dorival Caymmi</xLgr><nro>S/N</nro><xBairro>Itapuã</xBairro><cMun>2927408</cMun><xMun>Salvador</xMun><UF>BA</UF><CEP>41620500</CEP><cPais>1058</cPais><xPais>BRASIL</xPais></enderEmit><IE>107728249</IE><CRT>1</CRT></emit><det nItem=\"1\"><prod><cProd>004395</cProd><cEAN>SEM GTIN</cEAN><xProd>NOTA FISCAL EMITIDA EM AMBIENTE DE HOMOLOGACAO - SEM VALOR FISCAL</xProd><NCM>61130000</NCM><CFOP>5102</CFOP><uCom>UN</uCom><qCom>1.0000</qCom><vUnCom>12.2400000000</vUnCom><vProd>12.24</vProd><cEANTrib>SEM GTIN</cEANTrib><uTrib>UN</uTrib><qTrib>1.0000</qTrib><vUnTrib>12.2400000000</vUnTrib><indTot>1</indTot></prod><imposto><vTotTrib>2.71</vTotTrib><ICMS><ICMSSN102><orig>0</orig><CSOSN>103</CSOSN></ICMSSN102></ICMS></imposto></det><total><ICMSTot><vBC>0.00</vBC><vICMS>0.00</vICMS><vICMSDeson>0.00</vICMSDeson><vFCPUFDest>0.00</vFCPUFDest><vICMSUFDest>0.00</vICMSUFDest><vICMSUFRemet>0.00</vICMSUFRemet><vFCP>0.00</vFCP><vBCST>0.00</vBCST><vST>0.00</vST><vFCPST>0.00</vFCPST><vFCPSTRet>0.00</vFCPSTRet><vProd>12.24</vProd><vFrete>0.00</vFrete><vSeg>0.00</vSeg><vDesc>0.00</vDesc><vII>0.00</vII><vIPI>0.00</vIPI><vIPIDevol>0.00</vIPIDevol><vPIS>0.00</vPIS><vCOFINS>0.00</vCOFINS><vOutro>0.00</vOutro><vNF>12.24</vNF><vTotTrib>2.71</vTotTrib></ICMSTot></total><transp><modFrete>9</modFrete></transp><pag><detPag><tPag>01</tPag><vPag>12.24</vPag></detPag><vTroco>0.00</vTroco></pag><infAdic><infCpl>Trib aprox: 0,51 Federal, 2,20 Estadual e Municipal: 0 Fonte: 6A098E</infCpl></infAdic></infNFe></NFe>";
            var retorno = servNfe.Autorizar(xml, true);
        }

        [TestMethod]
        [Description("Transmitir uma Nota Fiscal NFCe usando uma string XMl")]
        public void TransmitirNotaFiscalComsumidorUsandoUmaStringXml()
        {
            try
            {
                var c1 = ObterConfiguracao();
                var config = new Configurar(c1);
                var servNfe = new ServNFe4(config.EmissorConfig);
                var xml =
                        "<NFe xmlns=\"http://www.portalfiscal.inf.br/nfe\"><infNFe versao=\"4.00\"><ide><cUF>29</cUF><cNF>1712</cNF><natOp>Venda de mercadoria adquirida ou recebida de terceiros</natOp><mod>65</mod><serie>7</serie><nNF>1711</nNF><dhEmi>2020-04-09T14:24:30-03:00</dhEmi><tpNF>1</tpNF><idDest>1</idDest><cMunFG>2927408</cMunFG><tpImp>4</tpImp><tpEmis>1</tpEmis><cDV>0</cDV><tpAmb>2</tpAmb><finNFe>1</finNFe><indFinal>1</indFinal><indPres>1</indPres><procEmi>0</procEmi><verProc>4.00</verProc></ide><emit><CNPJ>17784038000103</CNPJ><xNome>KAP RIBEIRO COMERCIO DE BICICLETAS EIRELI</xNome><xFant>ANAILTON DE OLIVEIRA RIBEIRO</xFant><enderEmit><xLgr>Praça Dorival Caymmi</xLgr><nro>S/N</nro><xBairro>Itapuã</xBairro><cMun>2927408</cMun><xMun>Salvador</xMun><UF>BA</UF><CEP>41620500</CEP><cPais>1058</cPais><xPais>BRASIL</xPais></enderEmit><IE>107728249</IE><CRT>1</CRT></emit><det nItem=\"1\"><prod><cProd>004395</cProd><cEAN>SEM GTIN</cEAN><xProd>NOTA FISCAL EMITIDA EM AMBIENTE DE HOMOLOGACAO - SEM VALOR FISCAL</xProd><NCM>61130000</NCM><CFOP>5102</CFOP><uCom>UN</uCom><qCom>1.0000</qCom><vUnCom>12.2400000000</vUnCom><vProd>12.24</vProd><cEANTrib>SEM GTIN</cEANTrib><uTrib>UN</uTrib><qTrib>1.0000</qTrib><vUnTrib>12.2400000000</vUnTrib><indTot>1</indTot></prod><imposto><vTotTrib>2.71</vTotTrib><ICMS><ICMSSN102><orig>0</orig><CSOSN>103</CSOSN></ICMSSN102></ICMS></imposto></det><total><ICMSTot><vBC>0.00</vBC><vICMS>0.00</vICMS><vICMSDeson>0.00</vICMSDeson><vFCPUFDest>0.00</vFCPUFDest><vICMSUFDest>0.00</vICMSUFDest><vICMSUFRemet>0.00</vICMSUFRemet><vFCP>0.00</vFCP><vBCST>0.00</vBCST><vST>0.00</vST><vFCPST>0.00</vFCPST><vFCPSTRet>0.00</vFCPSTRet><vProd>12.24</vProd><vFrete>0.00</vFrete><vSeg>0.00</vSeg><vDesc>0.00</vDesc><vII>0.00</vII><vIPI>0.00</vIPI><vIPIDevol>0.00</vIPIDevol><vPIS>0.00</vPIS><vCOFINS>0.00</vCOFINS><vOutro>0.00</vOutro><vNF>12.24</vNF><vTotTrib>2.71</vTotTrib></ICMSTot></total><transp><modFrete>9</modFrete></transp><pag><detPag><tPag>01</tPag><vPag>12.24</vPag></detPag><vTroco>0.00</vTroco></pag><infAdic><infCpl>Trib aprox: 0,51 Federal, 2,20 Estadual e Municipal: 0 Fonte: 6A098E</infCpl></infAdic></infNFe></NFe>";
                var retorno = servNfe.Autorizar(xml);
            }
            catch (Exception e)
            {
                Console.WriteLine(e);
                throw;
            }
        } 

        [TestMethod]
        [Description("Transmitir uma Nota Fiscal para Cancelamento")]
        public void TransmitirNotaFiscalEletronicaCancelamento()
        {
            var c1 = ObterConfiguracao();
            var config = new Configurar(c1);
            var servNfe = new ServNFe4(config.EmissorConfig);
            var xml =
                    "<NFe xmlns=\"http://www.portalfiscal.inf.br/nfe\"><infNFe versao=\"4.00\"><ide><cUF>29</cUF><cNF>252</cNF><natOp>Venda de mercadoria adquirida ou recebida de terceiros</natOp><mod>65</mod><serie>1</serie><nNF>6798</nNF><dhEmi>" +
                    Utils.ObterDataBrasil() +
                    "</dhEmi><tpNF>1</tpNF><idDest>1</idDest><cMunFG>2927408</cMunFG><tpImp>4</tpImp><tpEmis>1</tpEmis><cDV>0</cDV><tpAmb>2</tpAmb><finNFe>1</finNFe><indFinal>1</indFinal><indPres>1</indPres><procEmi>0</procEmi><verProc>Test 1.0</verProc></ide><emit><CNPJ>32806205000155</CNPJ><xNome>BIKETOP COMER. E SERV. DE BICICLETAS EIRELI</xNome><xFant>PLANETA BIKE</xFant><enderEmit><xLgr>Rua Virgildasio Sena</xLgr><nro>215</nro><xBairro>Boca do Rio</xBairro><cMun>2927408</cMun><xMun>Salvador</xMun><UF>BA</UF><CEP>41710220</CEP><cPais>1058</cPais><xPais>Brasil</xPais></enderEmit><IE>155731233</IE><IM>00000000000000</IM><CRT>1</CRT></emit><det nItem=\"1\"><prod><cProd>1656</cProd><cEAN>SEM GTIN</cEAN><xProd>NOTA FISCAL EMITIDA EM AMBIENTE DE HOMOLOGACAO - SEM VALOR FISCAL</xProd><NCM>87120010</NCM><CFOP>5102</CFOP><uCom>UN</uCom><qCom>1.0000</qCom><vUnCom>123.0000000000</vUnCom><vProd>123.00</vProd><cEANTrib>SEM GTIN</cEANTrib><uTrib>UN</uTrib><qTrib>1.0000</qTrib><vUnTrib>123.0000000000</vUnTrib><indTot>1</indTot></prod><imposto><vTotTrib>13.41</vTotTrib><ICMS><ICMSSN900><orig>5</orig><CSOSN>900</CSOSN></ICMSSN900></ICMS></imposto><infAdProd>Trib aprox R$: 13,41 Federal, 0,00 Estadual e 0,000000 Municipal. Fonte: IBPT 801EC4.</infAdProd></det><total><ICMSTot><vBC>0.00</vBC><vICMS>0.00</vICMS><vICMSDeson>0.00</vICMSDeson><vFCPUFDest>0.00</vFCPUFDest><vICMSUFDest>0.00</vICMSUFDest><vICMSUFRemet>0.00</vICMSUFRemet><vFCP>0.00</vFCP><vBCST>0.00</vBCST><vST>0.00</vST><vFCPST>0.00</vFCPST><vFCPSTRet>0.00</vFCPSTRet><vProd>123.00</vProd><vFrete>0.00</vFrete><vSeg>0.00</vSeg><vDesc>0.00</vDesc><vII>0.00</vII><vIPI>0.00</vIPI><vIPIDevol>0.00</vIPIDevol><vPIS>0.00</vPIS><vCOFINS>0.00</vCOFINS><vOutro>0.00</vOutro><vNF>123.00</vNF><vTotTrib>13.41</vTotTrib></ICMSTot></total><transp><modFrete>9</modFrete></transp><pag><detPag><tPag>01</tPag><vPag>123.00</vPag></detPag></pag><infAdic><infCpl>Trib aprox R$: 13,41 Federal, 0,00 Estadual e Municipal: 0,00 Fonte: IBPT 801EC4</infCpl></infAdic></infNFe></NFe>";
            // var retorno = servNfe.Autorizar(xml);
            //var status = retorno.Retorno.cStat;
            //if (status == 104)
            //{
            var protocolo = "329190000118543";
            var chave = "29190532806205000155650010000002231000001227";
            var canc = servNfe.CancelarNFe(1,
                    new List<EventoBuilder>
                    {
                            new EventoBuilder(1, protocolo, chave, "Motivo de Teste Motivo de Teste",
                                    config.EmissorConfig.Emitente.CNPJ)
                    }, "65");
            var ret2 = canc.Retorno;
            Assert.IsNotNull(ret2);
            //}
        }

        [TestMethod]
        [Description("Transmitir uma Nota Fiscal de Carta de Correção")]
        public void TransmitirNotaFiscalEletronicaCartaCorrecao()
        {
            var c1 = ObterConfiguracao();
            var config = new Configurar(c1);
            var servNfe = new ServNFe4(config.EmissorConfig);
                 
            var protocolo = "329190000118543";
            var chave = "29190532806205000155650010000002231000001227";
            var canc = servNfe.CartaCorrecaoNFe(1,
                    new List<EventoBuilder>
                    {
                            new EventoBuilder(1, protocolo, chave, "Motivo de Teste Motivo de Teste",
                                    config.EmissorConfig.Emitente.CNPJ)
                    }, "65");
            var ret2 = canc.Retorno;
            Assert.IsNotNull(ret2);
             
        }

        [TestMethod]
        [Description("Transmitir uma Nota Fiscal NFe 55 usando uma string XMl, testando situações de contingência")]
        public void TransmitirNotaFiscalEletronicaUsandoUmaStringXmlTesteContigencia()
        {
            //para testar essa unidade é necessário induzir uma exception de timeout ou erro http 500 em [ServHttpSoapBase.ObterResposta]
            var c1 = ObterConfiguracao();
            var config = new Configurar(c1);
            var servNfe = new ServNFe4(config.EmissorConfig);
            var tpEmissao = "4"; //Se 4 entao o sistema deve obter a url de contingencia DPEC
            var xml =
                    "<NFe xmlns=\"http://www.portalfiscal.inf.br/nfe\"><infNFe versao=\"4.00\"><ide><cUF>29</cUF><cNF>15222</cNF><natOp>Devolucao de venda de mercadoria adquirida ou recebida de te</natOp><mod>55</mod><serie>1</serie><nNF>123</nNF><dhEmi>" +
                    DateTime.Now + "</dhEmi><tpNF>0</tpNF><idDest>1</idDest><cMunFG>2927408</cMunFG><tpImp>1</tpImp><tpEmis>" + tpEmissao +
                    "</tpEmis><cDV>0</cDV><tpAmb>2</tpAmb><finNFe>1</finNFe><indFinal>0</indFinal><indPres>1</indPres><procEmi>0</procEmi><verProc>4.00</verProc></ide><emit><CNPJ>32806205000155</CNPJ><xNome>YYYYYYYYYYYY</xNome><xFant>YYYYYYYYYYYY</xFant><enderEmit><xLgr>Rua Virgildasio Sena</xLgr><nro>215</nro><xBairro>Boca do Rio</xBairro><cMun>2927408</cMun><xMun>Salvador</xMun><UF>BA</UF><CEP>41710220</CEP><cPais>1058</cPais><xPais>Brasil</xPais></enderEmit><IE>155731233</IE><IM>00000000000000</IM><CRT>1</CRT></emit><dest><CPF>94782024568</CPF><xNome>NF-E EMITIDA EM AMBIENTE DE HOMOLOGACAO - SEM VALOR FISCAL</xNome><enderDest><xLgr>TRAVESSA SR DO BONFIM N 218</xLgr><nro>218</nro><xCpl>2o ANDAR</xCpl><xBairro>ENGOMADEIRA</xBairro><cMun>2927408</cMun><xMun>Salvador</xMun><UF>BA</UF><CEP>48000000</CEP><cPais>1058</cPais><xPais>Brasil</xPais></enderDest><indIEDest>9</indIEDest></dest><det nItem=\"1\"><prod><cProd>1860</cProd><cEAN>SEM GTIN</cEAN><xProd>NOTA FISCAL EMITIDA EM AMBIENTE DE HOMOLOGACAO - SEM VALOR FISCAL</xProd><NCM>87149500</NCM><CFOP>5102</CFOP><uCom>UN</uCom><qCom>1.0000</qCom><vUnCom>65.9000000000</vUnCom><vProd>65.90</vProd><cEANTrib>SEM GTIN</cEANTrib><uTrib>UN</uTrib><qTrib>1.0000</qTrib><vUnTrib>65.9000000000</vUnTrib><indTot>1</indTot></prod><imposto><vTotTrib>7.18</vTotTrib><ICMS><ICMSSN102><orig>2</orig><CSOSN>102</CSOSN></ICMSSN102></ICMS><IPI><cEnq>999</cEnq><IPINT><CST>53</CST></IPINT></IPI><PIS><PISOutr><CST>99</CST><vBC>65.90</vBC><pPIS>0.4300</pPIS><vPIS>0.28</vPIS></PISOutr></PIS><COFINS><COFINSOutr><CST>99</CST><vBC>65.90</vBC><pCOFINS>1.9800</pCOFINS><vCOFINS>1.30</vCOFINS></COFINSOutr></COFINS></imposto><infAdProd>Trib aprox R$: 7,18 Federal, 0,00 Estadual e 0,000000 Municipal. Fonte: IBPT D11D7F.</infAdProd></det><det nItem=\"2\"><prod><cProd>2021</cProd><cEAN>SEM GTIN</cEAN><xProd>NOTA FISCAL EMITIDA EM AMBIENTE DE HOMOLOGACAO - SEM VALOR FISCAL</xProd><NCM>40132000</NCM><CEST>1600900</CEST><CFOP>5102</CFOP><uCom>UN</uCom><qCom>1.0000</qCom><vUnCom>25.0000000000</vUnCom><vProd>25.00</vProd><cEANTrib>SEM GTIN</cEANTrib><uTrib>UN</uTrib><qTrib>1.0000</qTrib><vUnTrib>25.0000000000</vUnTrib><indTot>1</indTot></prod><imposto><vTotTrib>8.96</vTotTrib><ICMS><ICMSSN102><orig>1</orig><CSOSN>102</CSOSN></ICMSSN102></ICMS><IPI><cEnq>999</cEnq><IPINT><CST>53</CST></IPINT></IPI><PIS><PISOutr><CST>99</CST><vBC>25.00</vBC><pPIS>0.5000</pPIS><vPIS>0.13</vPIS></PISOutr></PIS><COFINS><COFINSOutr><CST>99</CST><vBC>25.00</vBC><pCOFINS>2.3800</pCOFINS><vCOFINS>0.60</vCOFINS></COFINSOutr></COFINS></imposto><infAdProd>Trib aprox R$: 4,46 Federal, 4,50 Estadual e 0,000000 Municipal. Fonte: IBPT D11D7F.</infAdProd></det><total><ICMSTot><vBC>0.00</vBC><vICMS>0.00</vICMS><vICMSDeson>0.00</vICMSDeson><vFCPUFDest>0.00</vFCPUFDest><vICMSUFDest>0.00</vICMSUFDest><vICMSUFRemet>0.00</vICMSUFRemet><vFCP>0.00</vFCP><vBCST>0.00</vBCST><vST>0.00</vST><vFCPST>0.00</vFCPST><vFCPSTRet>0.00</vFCPSTRet><vProd>90.90</vProd><vFrete>0.00</vFrete><vSeg>0.00</vSeg><vDesc>0.00</vDesc><vII>0.00</vII><vIPI>0.00</vIPI><vIPIDevol>0.00</vIPIDevol><vPIS>0.00</vPIS><vCOFINS>0.00</vCOFINS><vOutro>0.00</vOutro><vNF>90.90</vNF><vTotTrib>16.14</vTotTrib></ICMSTot></total><transp><modFrete>9</modFrete></transp><pag><detPag><tPag>90</tPag><vPag>90.90</vPag></detPag></pag><infAdic><infCpl>Documento emitido por ME ou EPP optante pelo Simples Nacional. Nao gera direito a credito fiscal de IPI.</infCpl></infAdic></infNFe></NFe>";
            var r1 = servNfe.Autorizar(xml);

            //Levantar uma exceção por conta do tipo de emissão ser numero 1, quando deveria ser 4,6 ou 7
            //Assert.Throws<ArgumentOutOfRangeException>(() => servNfe.Autorizar(xml));
        }


        [ExpectedException(typeof(ArgumentOutOfRangeException))]
        [TestMethod]
        [Description("Transmitir uma Nota Fiscal NFe 55 usando uma string XMl, testando situações de contingência")]
        public void TransmitirNotaFiscalEletronicaUsandoUmaStringXmlTesteContigenciaDeveSerLancadoUmaException()
        {
            //para testar essa unidade é necessário induzir uma exception de timeout ou erro http 500 em [ServHttpSoapBase.ObterResposta]
            var c1 = ObterConfiguracao();
            var config = new Configurar(c1);
            var servNfe = new ServNFe4(config.EmissorConfig);
            var tpEmissao = "1";
            var xml =
                    "<NFe xmlns=\"http://www.portalfiscal.inf.br/nfe\"><infNFe versao=\"4.00\"><ide><cUF>29</cUF><cNF>15222</cNF><natOp>Devolucao de venda de mercadoria adquirida ou recebida de te</natOp><mod>55</mod><serie>1</serie><nNF>123</nNF><dhEmi>" +
                    Utils.ObterDataBrasil() + "</dhEmi><tpNF>0</tpNF><idDest>1</idDest><cMunFG>2927408</cMunFG><tpImp>1</tpImp><tpEmis>" + tpEmissao +
                    "</tpEmis><cDV>0</cDV><tpAmb>2</tpAmb><finNFe>1</finNFe><indFinal>0</indFinal><indPres>1</indPres><procEmi>0</procEmi><verProc>4.00</verProc></ide><emit><CNPJ>32806205000155</CNPJ><xNome>YYYYYYYYYYYY</xNome><xFant>YYYYYYYYYYYY</xFant><enderEmit><xLgr>Rua Virgildasio Sena</xLgr><nro>215</nro><xBairro>Boca do Rio</xBairro><cMun>2927408</cMun><xMun>Salvador</xMun><UF>BA</UF><CEP>41710220</CEP><cPais>1058</cPais><xPais>Brasil</xPais></enderEmit><IE>155731233</IE><IM>00000000000000</IM><CRT>1</CRT></emit><dest><CPF>94782024568</CPF><xNome>NF-E EMITIDA EM AMBIENTE DE HOMOLOGACAO - SEM VALOR FISCAL</xNome><enderDest><xLgr>TRAVESSA SR DO BONFIM N 218</xLgr><nro>218</nro><xCpl>2o ANDAR</xCpl><xBairro>ENGOMADEIRA</xBairro><cMun>2927408</cMun><xMun>Salvador</xMun><UF>BA</UF><CEP>48000000</CEP><cPais>1058</cPais><xPais>Brasil</xPais></enderDest><indIEDest>9</indIEDest></dest><det nItem=\"1\"><prod><cProd>1860</cProd><cEAN>SEM GTIN</cEAN><xProd>NOTA FISCAL EMITIDA EM AMBIENTE DE HOMOLOGACAO - SEM VALOR FISCAL</xProd><NCM>87149500</NCM><CFOP>5102</CFOP><uCom>UN</uCom><qCom>1.0000</qCom><vUnCom>65.9000000000</vUnCom><vProd>65.90</vProd><cEANTrib>SEM GTIN</cEANTrib><uTrib>UN</uTrib><qTrib>1.0000</qTrib><vUnTrib>65.9000000000</vUnTrib><indTot>1</indTot></prod><imposto><vTotTrib>7.18</vTotTrib><ICMS><ICMSSN102><orig>2</orig><CSOSN>102</CSOSN></ICMSSN102></ICMS><IPI><cEnq>999</cEnq><IPINT><CST>53</CST></IPINT></IPI><PIS><PISOutr><CST>99</CST><vBC>65.90</vBC><pPIS>0.4300</pPIS><vPIS>0.28</vPIS></PISOutr></PIS><COFINS><COFINSOutr><CST>99</CST><vBC>65.90</vBC><pCOFINS>1.9800</pCOFINS><vCOFINS>1.30</vCOFINS></COFINSOutr></COFINS></imposto><infAdProd>Trib aprox R$: 7,18 Federal, 0,00 Estadual e 0,000000 Municipal. Fonte: IBPT D11D7F.</infAdProd></det><det nItem=\"2\"><prod><cProd>2021</cProd><cEAN>SEM GTIN</cEAN><xProd>NOTA FISCAL EMITIDA EM AMBIENTE DE HOMOLOGACAO - SEM VALOR FISCAL</xProd><NCM>40132000</NCM><CEST>1600900</CEST><CFOP>5102</CFOP><uCom>UN</uCom><qCom>1.0000</qCom><vUnCom>25.0000000000</vUnCom><vProd>25.00</vProd><cEANTrib>SEM GTIN</cEANTrib><uTrib>UN</uTrib><qTrib>1.0000</qTrib><vUnTrib>25.0000000000</vUnTrib><indTot>1</indTot></prod><imposto><vTotTrib>8.96</vTotTrib><ICMS><ICMSSN102><orig>1</orig><CSOSN>102</CSOSN></ICMSSN102></ICMS><IPI><cEnq>999</cEnq><IPINT><CST>53</CST></IPINT></IPI><PIS><PISOutr><CST>99</CST><vBC>25.00</vBC><pPIS>0.5000</pPIS><vPIS>0.13</vPIS></PISOutr></PIS><COFINS><COFINSOutr><CST>99</CST><vBC>25.00</vBC><pCOFINS>2.3800</pCOFINS><vCOFINS>0.60</vCOFINS></COFINSOutr></COFINS></imposto><infAdProd>Trib aprox R$: 4,46 Federal, 4,50 Estadual e 0,000000 Municipal. Fonte: IBPT D11D7F.</infAdProd></det><total><ICMSTot><vBC>0.00</vBC><vICMS>0.00</vICMS><vICMSDeson>0.00</vICMSDeson><vFCPUFDest>0.00</vFCPUFDest><vICMSUFDest>0.00</vICMSUFDest><vICMSUFRemet>0.00</vICMSUFRemet><vFCP>0.00</vFCP><vBCST>0.00</vBCST><vST>0.00</vST><vFCPST>0.00</vFCPST><vFCPSTRet>0.00</vFCPSTRet><vProd>90.90</vProd><vFrete>0.00</vFrete><vSeg>0.00</vSeg><vDesc>0.00</vDesc><vII>0.00</vII><vIPI>0.00</vIPI><vIPIDevol>0.00</vIPIDevol><vPIS>0.00</vPIS><vCOFINS>0.00</vCOFINS><vOutro>0.00</vOutro><vNF>90.90</vNF><vTotTrib>16.14</vTotTrib></ICMSTot></total><transp><modFrete>9</modFrete></transp><pag><detPag><tPag>90</tPag><vPag>90.90</vPag></detPag></pag><infAdic><infCpl>Documento emitido por ME ou EPP optante pelo Simples Nacional. Nao gera direito a credito fiscal de IPI.</infCpl></infAdic></infNFe></NFe>";
            //Levantar uma exceção por conta do tipo de emissão ser numero 1, quando deveria ser 4,6 ou 7
            //Assert.Throws<ArgumentOutOfRangeException>(() => servNfe.Autorizar(xml));
        }

        [TestMethod]
        [Description("Transmitir uma Nota Fiscal Modelo 55 de modo assincrono usando uma string XMl")]
        public void TransmitirNotaFiscalModelo55AssincronamenteUsandoUmaStringXml()
        {
            var c1 = ObterConfiguracao();
            var config = new Configurar(c1);
            var servNfe = new ServNFe4(config.EmissorConfig);
            //var xml = "<NFe xmlns=\"http://www.portalfiscal.inf.br/nfe\"><infNFe versao=\"4.00\"><ide><cUF>29</cUF><cNF>15222</cNF><natOp>Devolucao de venda de mercadoria adquirida ou recebida de te</natOp><mod>55</mod><serie>1</serie><nNF>123</nNF><dhEmi>" + Utils.ObterDataBrasil() + "</dhEmi><tpNF>0</tpNF><idDest>1</idDest><cMunFG>2927408</cMunFG><tpImp>1</tpImp><tpEmis>1</tpEmis><cDV>0</cDV><tpAmb>2</tpAmb><finNFe>1</finNFe><indFinal>0</indFinal><indPres>1</indPres><procEmi>0</procEmi><verProc>4.00</verProc></ide><emit><CNPJ>32806205000155</CNPJ><xNome>YYYYYYYYYYYY</xNome><xFant>YYYYYYYYYYYY</xFant><enderEmit><xLgr>Rua Virgildasio Sena</xLgr><nro>215</nro><xBairro>Boca do Rio</xBairro><cMun>2927408</cMun><xMun>Salvador</xMun><UF>BA</UF><CEP>41710220</CEP><cPais>1058</cPais><xPais>Brasil</xPais></enderEmit><IE>155731233</IE><IM>00000000000000</IM><CRT>1</CRT></emit><dest><CPF>94782024568</CPF><xNome>NF-E EMITIDA EM AMBIENTE DE HOMOLOGACAO - SEM VALOR FISCAL</xNome><enderDest><xLgr>TRAVESSA SR DO BONFIM N 218</xLgr><nro>218</nro><xCpl>2o ANDAR</xCpl><xBairro>ENGOMADEIRA</xBairro><cMun>2927408</cMun><xMun>Salvador</xMun><UF>BA</UF><CEP>48000000</CEP><cPais>1058</cPais><xPais>Brasil</xPais></enderDest><indIEDest>9</indIEDest></dest><det nItem=\"1\"><prod><cProd>1860</cProd><cEAN>SEM GTIN</cEAN><xProd>NOTA FISCAL EMITIDA EM AMBIENTE DE HOMOLOGACAO - SEM VALOR FISCAL</xProd><NCM>87149500</NCM><CFOP>5102</CFOP><uCom>UN</uCom><qCom>1.0000</qCom><vUnCom>65.9000000000</vUnCom><vProd>65.90</vProd><cEANTrib>SEM GTIN</cEANTrib><uTrib>UN</uTrib><qTrib>1.0000</qTrib><vUnTrib>65.9000000000</vUnTrib><indTot>1</indTot></prod><imposto><vTotTrib>7.18</vTotTrib><ICMS><ICMSSN102><orig>2</orig><CSOSN>102</CSOSN></ICMSSN102></ICMS><IPI><cEnq>999</cEnq><IPINT><CST>53</CST></IPINT></IPI><PIS><PISOutr><CST>99</CST><vBC>65.90</vBC><pPIS>0.4300</pPIS><vPIS>0.28</vPIS></PISOutr></PIS><COFINS><COFINSOutr><CST>99</CST><vBC>65.90</vBC><pCOFINS>1.9800</pCOFINS><vCOFINS>1.30</vCOFINS></COFINSOutr></COFINS></imposto><infAdProd>Trib aprox R$: 7,18 Federal, 0,00 Estadual e 0,000000 Municipal. Fonte: IBPT D11D7F.</infAdProd></det><det nItem=\"2\"><prod><cProd>2021</cProd><cEAN>SEM GTIN</cEAN><xProd>NOTA FISCAL EMITIDA EM AMBIENTE DE HOMOLOGACAO - SEM VALOR FISCAL</xProd><NCM>40132000</NCM><CEST>1600900</CEST><CFOP>5102</CFOP><uCom>UN</uCom><qCom>1.0000</qCom><vUnCom>25.0000000000</vUnCom><vProd>25.00</vProd><cEANTrib>SEM GTIN</cEANTrib><uTrib>UN</uTrib><qTrib>1.0000</qTrib><vUnTrib>25.0000000000</vUnTrib><indTot>1</indTot></prod><imposto><vTotTrib>8.96</vTotTrib><ICMS><ICMSSN102><orig>1</orig><CSOSN>102</CSOSN></ICMSSN102></ICMS><IPI><cEnq>999</cEnq><IPINT><CST>53</CST></IPINT></IPI><PIS><PISOutr><CST>99</CST><vBC>25.00</vBC><pPIS>0.5000</pPIS><vPIS>0.13</vPIS></PISOutr></PIS><COFINS><COFINSOutr><CST>99</CST><vBC>25.00</vBC><pCOFINS>2.3800</pCOFINS><vCOFINS>0.60</vCOFINS></COFINSOutr></COFINS></imposto><infAdProd>Trib aprox R$: 4,46 Federal, 4,50 Estadual e 0,000000 Municipal. Fonte: IBPT D11D7F.</infAdProd></det><total><ICMSTot><vBC>0.00</vBC><vICMS>0.00</vICMS><vICMSDeson>0.00</vICMSDeson><vFCPUFDest>0.00</vFCPUFDest><vICMSUFDest>0.00</vICMSUFDest><vICMSUFRemet>0.00</vICMSUFRemet><vFCP>0.00</vFCP><vBCST>0.00</vBCST><vST>0.00</vST><vFCPST>0.00</vFCPST><vFCPSTRet>0.00</vFCPSTRet><vProd>90.90</vProd><vFrete>0.00</vFrete><vSeg>0.00</vSeg><vDesc>0.00</vDesc><vII>0.00</vII><vIPI>0.00</vIPI><vIPIDevol>0.00</vIPIDevol><vPIS>0.00</vPIS><vCOFINS>0.00</vCOFINS><vOutro>0.00</vOutro><vNF>90.90</vNF><vTotTrib>16.14</vTotTrib></ICMSTot></total><transp><modFrete>9</modFrete></transp><pag><detPag><tPag>90</tPag><vPag>90.90</vPag></detPag></pag><infAdic><infCpl>Documento emitido por ME ou EPP optante pelo Simples Nacional. Nao gera direito a credito fiscal de IPI.</infCpl></infAdic></infNFe></NFe>";
            //var retorno = servNfe.Autorizar(xml);
            //var recibo = "291100010193770"; //retorno.Retorno.infRec.nRec;
            var recibo = "291100010197259";
            //Consultar pelo Recibo
            var retorno2 = servNfe.ConsultarPeloRecibo(recibo, "55");
        }


        [TestMethod]
        [Description("Obter dados de retorno do serviço")]
        public void TratamentoDadosRetornoServico()
        {
            var retorno =
                    "<?xml version=\"1.0\" encoding=\"utf -8\"?><retConsStatServ versao = \"1.07\" xmlns = \"http://www.portalfiscal.inf.br/nfe\">" +
                    "<tpAmb>2</tpAmb><verAplic>SVRS20100112141427</verAplic><cStat>107</cStat>" +
                    "<xMotivo>Servico em Operacao</xMotivo><cUF>33</cUF>" +
                    "<dhRecbto>2010 - 02 - 07T01: 04:19</dhRecbto><tMed>1</tMed></retConsStatServ>";
            var s1 = Utils.ObterValorNodeStringXml(retorno, "cStat");
            Assert.AreEqual("107", s1);
            var s2 = Utils.ObterValorNodeStringXml(retorno, "xMotivo");
           Assert.AreEqual("Servico em Operacao", s2);
            var s3 = Utils.ObterValorNodeStringXml(retorno, "cUF");
           Assert.AreEqual("33", s3);
            var s4 = Utils.ObterValorNodeStringXml(retorno, "dhRecbto");
           Assert.AreEqual("2010 - 02 - 07T01: 04:19", s4);
        }

        [TestMethod]
        [Description("Deserializar Xml RetEnviNFe")]
        public void TratarRetornoAutorizacao()
        {
            //Obter arquivo
            var retorno = Utils.LerArquivo("Arquivos", "RetEnvieNFe.xml");
            //Obter Node
            var node = Utils.ObterNodeDeStringXml("retEnviNFe", retorno);
            var retENviNFe = Utils.XmlStringParaClasse<retEnviNFe>(node);
            var count = retENviNFe.protNFe.infProt.Count;
           Assert.AreEqual(3, count);
        }

        [TestMethod]
        [Description("Deserializar XMl retConsStatServ")]
        public void TratarRetornoConsultaStatus()
        {
            //Obter arquivo
            var retorno = Utils.LerArquivo("Arquivos", "RetConsStatServ.xml");
            //Obter Node
            var node = Utils.ObterNodeDeStringXml("retConsStatServ", retorno);
            var retConsNFe = Utils.XmlStringParaClasse<retConsStatServ>(node);
            var codStatus = retConsNFe.cStat;
           Assert.AreEqual(107, codStatus);
        }
    }
}
